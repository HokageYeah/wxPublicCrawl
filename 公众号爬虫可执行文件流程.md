# å…¬ä¼—å·çˆ¬è™«æ¡Œé¢ç«¯ç¨‹åº - å®æ–½æ–¹æ¡ˆä¸ä½¿ç”¨æŒ‡å—

> **çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æŠ•å…¥ä½¿ç”¨  
> **æœ€åæ›´æ–°**: 2025-12-22  
> **ç‰ˆæœ¬**: v1.0

## 1. é¡¹ç›®æ¦‚è¿°

å°† "å¾®ä¿¡å…¬ä¼—å·çˆ¬è™«ï¼ˆåŸºäºå¾®ä¿¡å®˜æ–¹æ¥å£ï¼‰" å°è£…ä¸ºç‹¬ç«‹çš„æ¡Œé¢å¯æ‰§è¡Œç¨‹åºï¼ˆ.exe/.appï¼‰ï¼Œæä¾›åŸç”Ÿæ¡Œé¢åº”ç”¨ä½“éªŒã€‚

### 1.1 æ ¸å¿ƒåŠŸèƒ½
- âœ… æ‰«ç ç™»å½•å¾®ä¿¡å…¬ä¼—å·å¹³å°
- âœ… æœç´¢å¹¶æµè§ˆå…¬ä¼—å·
- âœ… æŸ¥çœ‹æ–‡ç« åˆ—è¡¨ï¼ˆåˆ†é¡µåŠ è½½ï¼‰
- âœ… æŸ¥çœ‹æ–‡ç« è¯¦æƒ…å¹¶ä¸‹è½½ä¿å­˜
- âœ… æœ¬åœ°åŒ–å­˜å‚¨ï¼ˆSQLiteï¼‰
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆmacOS/Windowsï¼‰

### 1.2 åº”ç”¨ç‰¹ç‚¹
- ğŸš€ **ç‹¬ç«‹è¿è¡Œ**ï¼šæ— éœ€å®‰è£… Python ç¯å¢ƒ
- ğŸ’¾ **è½»é‡å­˜å‚¨**ï¼šä½¿ç”¨ SQLiteï¼Œæ•°æ®ä¿å­˜åœ¨ç”¨æˆ·ç›®å½•
- ğŸ”’ **å•å®ä¾‹è¿è¡Œ**ï¼šé˜²æ­¢å¤šå¼€ï¼Œé¿å…ç«¯å£å†²çª
- ğŸ“Š **å®Œæ•´æ—¥å¿—**ï¼šæ‰€æœ‰æ“ä½œå¯è¿½æº¯
- ğŸ¨ **ç°ä»£ç•Œé¢**ï¼šåŸºäº Vue 3 çš„å“åº”å¼è®¾è®¡

## 2. æŠ€æœ¯æ¶æ„

é‡‡ç”¨ **B/S æ··åˆæ¶æ„**ï¼ˆBrowser/Serverï¼‰ï¼Œç»“åˆ Python åç«¯èƒ½åŠ›å’Œ Web å‰ç«¯äº¤äº’ä½“éªŒã€‚

### 2.1 æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | è¯´æ˜ |
|------|------|------|
| **å‰ç«¯** | Vue 3 + TypeScript | å“åº”å¼ UIï¼Œç±»å‹å®‰å…¨ |
| **æ ·å¼** | TailwindCSS + UnoCSS | åŸå­åŒ– CSSï¼Œå¿«é€Ÿå¼€å‘ |
| **åç«¯** | Python 3.9+ + FastAPI | é«˜æ€§èƒ½å¼‚æ­¥æ¡†æ¶ |
| **æ•°æ®åº“** | SQLite | è½»é‡çº§ï¼Œæ— éœ€å•ç‹¬å®‰è£… |
| **å®¹å™¨** | PyWebView | è½»é‡çº§ Webview å®¹å™¨ |
| **æ‰“åŒ…** | PyInstaller | ç”Ÿæˆç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶ |

### 2.2 æ¶æ„ä¼˜åŠ¿

**ç›¸æ¯” Electron çš„ä¼˜åŠ¿**ï¼š
- âœ… **ä½“ç§¯æ›´å°**ï¼šçº¦ 50MB vs Electron çš„ 150MB+
- âœ… **èµ„æºå ç”¨ä½**ï¼šä½¿ç”¨ç³»ç»Ÿ WebViewï¼Œä¸æ‰“åŒ…æµè§ˆå™¨å¼•æ“
- âœ… **å¯åŠ¨æ›´å¿«**ï¼šæ— éœ€åŠ è½½å®Œæ•´ Chromium
- âœ… **Python ç”Ÿæ€**ï¼šç›´æ¥ä½¿ç”¨ä¸°å¯Œçš„ Python åº“

### 2.3 æ¶æ„å›¾

```mermaid
graph TB
    User[ğŸ‘¤ ç”¨æˆ·] --> |äº¤äº’| Window[ğŸªŸ æ¡Œé¢çª—å£<br/>PyWebView]
    Window --> |åŠ è½½| Frontend[ğŸ¨ Vue3 å‰ç«¯<br/>web/dist]
    Frontend --> |HTTP| Backend[âš™ï¸ FastAPI æœåŠ¡<br/>127.0.0.1:18000]
    Backend --> |ä¸šåŠ¡é€»è¾‘| Service[ğŸ“¦ wx_public.py]
    Service --> |ç½‘ç»œè¯·æ±‚| WxServer[â˜ï¸ å¾®ä¿¡æœåŠ¡å™¨<br/>mp.weixin.qq.com]
    Service --> |æ•°æ®æŒä¹…åŒ–| SQLite[ğŸ’¾ SQLite<br/>æœ¬åœ°æ•°æ®åº“]
    Service --> |æ–‡ä»¶æ“ä½œ| FileSystem[ğŸ“ æœ¬åœ°æ–‡ä»¶<br/>ç”¨æˆ·ç›®å½•]
    
    style Window fill:#e3f2fd
    style Frontend fill:#f3e5f5
    style Backend fill:#fff3e0
    style SQLite fill:#e8f5e9
```

### 2.4 æ•°æ®æµè½¬

```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯äº‹ä»¶ â†’ API è¯·æ±‚ â†’ åç«¯å¤„ç† â†’ è¿”å›æ•°æ® â†’ UI æ›´æ–°
                â†“
            å¾®ä¿¡æœåŠ¡å™¨
                â†“
          SQLite æŒä¹…åŒ–
```

## 3. è¿è¡Œæµç¨‹

### 3.1 å¯åŠ¨æµç¨‹ï¼ˆå·²å®ç°ï¼‰

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ç”¨æˆ·
    participant App as ğŸš€ åº”ç”¨ç¨‹åº
    participant Lock as ğŸ”’ å•å®ä¾‹æ£€æŸ¥
    participant Server as âš™ï¸ FastAPI æœåŠ¡
    participant Window as ğŸªŸ PyWebView çª—å£
    
    User->>App: åŒå‡»å¯åŠ¨
    App->>Lock: æ£€æŸ¥å®ä¾‹ä¸ç«¯å£
    Lock-->>App: âœ“ æ— å†²çª
    App->>Server: å¯åŠ¨åå°æœåŠ¡<br/>(127.0.0.1:18000)
    Server-->>App: âœ“ æœåŠ¡å°±ç»ª
    App->>Window: åˆ›å»ºçª—å£å¹¶åŠ è½½å‰ç«¯
    Window-->>User: æ˜¾ç¤ºç™»å½•ç•Œé¢
```

**è¯¦ç»†æ­¥éª¤**ï¼š

1. **ç¯å¢ƒæ£€æŸ¥** (5ç§’å†…å®Œæˆ)
   - è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`ENV=desktop`, `DB_DRIVER=sqlite`
   - æ£€æŸ¥å•å®ä¾‹é”æ–‡ä»¶ï¼ˆ`~/Library/Application Support/WxPublicCrawler/app.lock`ï¼‰
   - æ£€æŸ¥ç«¯å£ 18000 å¯ç”¨æ€§
   - åˆå§‹åŒ– SQLite æ•°æ®åº“

2. **åç«¯å¯åŠ¨** (çº¿ç¨‹æ¨¡å¼)
   - å¯åŠ¨ Uvicorn ç›‘å¬ 127.0.0.1:18000
   - æŒ‚è½½é™æ€æ–‡ä»¶ï¼ˆ`/crawl-desktop/` â†’ `web/dist/`ï¼‰
   - åŠ è½½ FastAPI è·¯ç”±å’Œä¸­é—´ä»¶

3. **å‰ç«¯åŠ è½½** (çª—å£åˆ›å»º)
   - ä½¿ç”¨ PyWebView åˆ›å»ºçª—å£ï¼ˆ800x600ï¼Œå¯è°ƒæ•´ï¼‰
   - åŠ è½½ `http://127.0.0.1:18000/crawl-desktop/`
   - æ˜¾ç¤ºç™»å½•é¡µé¢

### 3.2 ä¸šåŠ¡æµç¨‹ï¼ˆå·²å®ç°ï¼‰

#### é˜¶æ®µ 1: å¾®ä¿¡ç™»å½•

```
ç”¨æˆ·æ‰“å¼€åº”ç”¨
    â†“
æ˜¾ç¤ºäºŒç»´ç ï¼ˆAPI: /api/v1/wx/public/login/get-wx-login-qrcodeï¼‰
    â†“
ç”¨æˆ·æ‰«ç ç¡®è®¤
    â†“
è½®è¯¢çŠ¶æ€ï¼ˆAPI: /api/v1/wx/public/login/get-qrcode-statusï¼‰
    â†“
ç™»å½•æˆåŠŸ â†’ ä¿å­˜ Cookies â†’ è·³è½¬æœç´¢é¡µ
```

**å…³é”® API**ï¼š
- `POST /api/v1/wx/public/login/prelogin` - é¢„ç™»å½•
- `POST /api/v1/wx/public/login/startlogin` - å¼€å§‹ç™»å½•
- `GET /api/v1/wx/public/login/get-wx-login-qrcode` - è·å–äºŒç»´ç 
- `POST /api/v1/wx/public/login/get-qrcode-status` - æŸ¥è¯¢çŠ¶æ€

#### é˜¶æ®µ 2: æœç´¢å…¬ä¼—å·

```
è¾“å…¥å…¬ä¼—å·åç§°
    â†“
è°ƒç”¨æœç´¢ API
    â†“
å±•ç¤ºæœç´¢ç»“æœï¼ˆå¤´åƒã€åç§°ã€æè¿°ï¼‰
    â†“
é€‰æ‹©ç›®æ ‡å…¬ä¼—å· â†’ è®°å½• fakeid â†’ è·³è½¬æ–‡ç« åˆ—è¡¨
```

**å…³é”® API**ï¼š
- `GET /api/v1/wx/public/search-wx-public?query=åç§°&begin=0&count=10`

#### é˜¶æ®µ 3: æµè§ˆä¸ä¸‹è½½æ–‡ç« 

```
æŸ¥çœ‹æ–‡ç« åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
    â†“
é€‰æ‹©æ–‡ç« 
    â†“
æŸ¥çœ‹è¯¦æƒ… / ä¸‹è½½
    â†“
ä¿å­˜åˆ°æœ¬åœ°
    â”œâ”€ HTML æ–‡ä»¶
    â”œâ”€ å›¾ç‰‡èµ„æº
    â””â”€ å…ƒæ•°æ®è®°å½•åˆ° SQLite
```

**å…³é”® API**ï¼š
- `POST /api/v1/wx/public/get-wx-article-list` - æ–‡ç« åˆ—è¡¨
- `POST /api/v1/wx/public/get-wx-article-detail-by-link` - æ–‡ç« è¯¦æƒ…

**æ–‡ä»¶ä¿å­˜ä½ç½®**ï¼š
- macOS: `~/Library/Application Support/WxPublicCrawler/`
- Windows: `~/AppData/Local/WxPublicCrawler/`

## 4. å®ç°çŠ¶æ€ï¼ˆå·²å®Œæˆï¼‰

### âœ… ä»»åŠ¡ç»„ A: åç«¯é€‚é…

| ä»»åŠ¡ | çŠ¶æ€ | å®ç°ä½ç½® |
|------|------|---------|
| é™æ€èµ„æºæœåŠ¡ | âœ… å®Œæˆ | `app/main.py` - æŒ‚è½½ `/crawl-desktop/` |
| æ¡Œé¢å…¥å£è„šæœ¬ | âœ… å®Œæˆ | `run_desktop.py` - ä¸»å…¥å£ |
| SQLite é€‚é… | âœ… å®Œæˆ | `app/config/database_config.py` |
| æ–‡ä»¶ç³»ç»Ÿå¤„ç† | âœ… å®Œæˆ | `app/utils/src_path.py` - å¯å†™ç›®å½• |
| ç¯å¢ƒé…ç½® | âœ… å®Œæˆ | `app/core/config.py` - æ¡Œé¢æ¨¡å¼ |
| å•å®ä¾‹æ§åˆ¶ | âœ… å®Œæˆ | `run_desktop.py` - æ–‡ä»¶é”æœºåˆ¶ |
| æ—¥å¿—ç³»ç»Ÿ | âœ… å®Œæˆ | è¾“å‡ºåˆ°ç”¨æˆ·æ—¥å¿—ç›®å½• |

**å…³é”®å®ç°**ï¼š

```python
# run_desktop.py
os.environ['ENV'] = 'desktop'
os.environ['DB_DRIVER'] = 'sqlite'

# å•å®ä¾‹æ£€æŸ¥
from filelock import FileLock
lock = FileLock(get_lock_file_path())

# å¯åŠ¨æœåŠ¡
uvicorn.run(app, host="127.0.0.1", port=18000)

# åˆ›å»ºçª—å£
webview.create_window('å…¬ä¼—å·çˆ¬è™«åŠ©æ‰‹', 'http://127.0.0.1:18000/crawl-desktop/')
```

### âœ… ä»»åŠ¡ç»„ B: å‰ç«¯å¼€å‘

| ä»»åŠ¡ | çŠ¶æ€ | å®ç°ä½ç½® |
|------|------|---------|
| Vue Router é…ç½® | âœ… å®Œæˆ | `web/src/router/index.ts` |
| ç™»å½•é¡µé¢ | âœ… å®Œæˆ | `web/src/views/WeChatLogin.vue` |
| æœç´¢é¡µé¢ | âœ… å®Œæˆ | `web/src/views/PublicSearch.vue` |
| æ–‡ç« åˆ—è¡¨é¡µ | âœ… å®Œæˆ | `web/src/views/ArticleList.vue` |
| API å°è£… | âœ… å®Œæˆ | `web/src/services/wechatService.ts` |
| çŠ¶æ€ç®¡ç† | âœ… å®Œæˆ | `web/src/stores/wechatLoginStore.ts` |
| è¯·æ±‚æ‹¦æˆªå™¨ | âœ… å®Œæˆ | `web/src/utils/request.ts` |

**æŠ€æœ¯ç»†èŠ‚**ï¼š
- ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†
- Axios ç»Ÿä¸€è¯·æ±‚å¤„ç†
- æ”¯æŒäºŒè¿›åˆ¶æ•°æ®ï¼ˆäºŒç»´ç å›¾ç‰‡ï¼‰
- å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒçª—å£å¤§å°

### âœ… ä»»åŠ¡ç»„ C: æ¡Œé¢å®¹å™¨

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| PyWebView é›†æˆ | âœ… å®Œæˆ | çª—å£å¤§å°ã€æ ‡é¢˜é…ç½® |
| ç”Ÿå‘½å‘¨æœŸç®¡ç† | âœ… å®Œæˆ | çª—å£å…³é—­æ—¶ç»ˆæ­¢æœåŠ¡ |
| å¤šè¿›ç¨‹å¤„ç† | âœ… å®Œæˆ | `multiprocessing.freeze_support()` |
| macOS å…¼å®¹æ€§ | âœ… å®Œæˆ | `set_start_method('spawn')` |

### âœ… ä»»åŠ¡ç»„ D: æ‰“åŒ…ä¸åˆ†å‘

| ä»»åŠ¡ | çŠ¶æ€ | å®ç°ä½ç½® |
|------|------|---------|
| PyInstaller é…ç½® | âœ… å®Œæˆ | `wx_crawler.spec` |
| macOS æ‰“åŒ…è„šæœ¬ | âœ… å®Œæˆ | `script/desktop/build_mac.sh` |
| Windows æ‰“åŒ…è„šæœ¬ | âœ… å®Œæˆ | `script/desktop/build_windows.bat` |
| æµ‹è¯•è„šæœ¬ | âœ… å®Œæˆ | `script/desktop/test_app.sh` |
| æ—¥å¿—æŸ¥çœ‹å·¥å…· | âœ… å®Œæˆ | `script/desktop/view_logs.sh` |
| æ¸…ç†è„šæœ¬ | âœ… å®Œæˆ | `script/desktop/kill_app.sh` |
| éªŒè¯å·¥å…· | âœ… å®Œæˆ | `script/desktop/verify_scripts.sh` |

**æ‰“åŒ…é…ç½®å…³é”®ç‚¹**ï¼š

```python
# wx_crawler.spec
datas=[
    ('web/dist', 'web/dist'),  # å‰ç«¯èµ„æº
    ('app/models', 'app/models'),  # æ•°æ®æ¨¡å‹
],
hiddenimports=[
    'uvicorn.logging',
    'sqlalchemy.sql.default_comparator',
    'sqlite3',  # SQLite æ”¯æŒ
    'multiprocessing',  # å¤šè¿›ç¨‹æ”¯æŒ
]
```

## 5. å®é™…ç›®å½•ç»“æ„

```
wxPublicCrawl/
â”œâ”€â”€ app/                          # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ api/                      # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ api.py
â”‚   â”‚   â””â”€â”€ endpoints/
â”‚   â”‚       â”œâ”€â”€ wx_public.py      # å¾®ä¿¡å…¬ä¼—å·æ¥å£
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ config/                   # é…ç½®æ¨¡å—
â”‚   â”‚   â””â”€â”€ database_config.py    # æ•°æ®åº“é…ç½®ï¼ˆæ”¯æŒ SQLite/MySQLï¼‰
â”‚   â”œâ”€â”€ core/                     # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py             # åº”ç”¨é…ç½®ï¼ˆæ”¯æŒå¤šç¯å¢ƒï¼‰
â”‚   â”‚   â””â”€â”€ logging_uru.py        # æ—¥å¿—é…ç½®
â”‚   â”œâ”€â”€ db/                       # æ•°æ®åº“
â”‚   â”‚   â””â”€â”€ sqlalchemy_db.py      # SQLAlchemy è¿æ¥
â”‚   â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ article.py
â”‚   â”œâ”€â”€ schemas/                  # Pydantic æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ wx_data.py
â”‚   â”‚   â””â”€â”€ common_data.py
â”‚   â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ wx_public.py          # å¾®ä¿¡å…¬ä¼—å·æœåŠ¡
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·ç±»
â”‚   â”‚   â”œâ”€â”€ src_path.py           # è·¯å¾„å¤„ç†ï¼ˆæ¡Œé¢é€‚é…ï¼‰
â”‚   â”‚   â””â”€â”€ wx_article_handle.py  # æ–‡ç« å¤„ç†
â”‚   â””â”€â”€ main.py                   # FastAPI åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ web/                          # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â”‚   â”œâ”€â”€ WeChatLogin.vue   # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ PublicSearch.vue  # æœç´¢é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ ArticleList.vue   # æ–‡ç« åˆ—è¡¨é¡µ
â”‚   â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts          # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ wechatLoginStore.ts # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ wechatService.ts  # API å°è£…
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â””â”€â”€ request.ts        # Axios å°è£…
â”‚   â”œâ”€â”€ dist/                     # æ„å»ºäº§ç‰©ï¼ˆæ‰“åŒ…æ—¶åŒ…å«ï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ script/                       # è„šæœ¬å·¥å…·
â”‚   â””â”€â”€ desktop/                  # æ¡Œé¢åº”ç”¨è„šæœ¬
â”‚       â”œâ”€â”€ build_mac.sh          # macOS æ‰“åŒ…
â”‚       â”œâ”€â”€ build_windows.bat     # Windows æ‰“åŒ…
â”‚       â”œâ”€â”€ test_app.sh           # æµ‹è¯•åº”ç”¨
â”‚       â”œâ”€â”€ view_logs.sh          # æŸ¥çœ‹æ—¥å¿—
â”‚       â”œâ”€â”€ kill_app.sh           # æ¸…ç†åº”ç”¨
â”‚       â”œâ”€â”€ verify_scripts.sh     # éªŒè¯å·¥å…·
â”‚       â”œâ”€â”€ README.md             # è„šæœ¬è¯´æ˜
â”‚       â””â”€â”€ MIGRATION_SUMMARY.md  # è¿ç§»æ€»ç»“
â”‚
â”œâ”€â”€ docs/                         # æ–‡æ¡£
â”‚   â”œâ”€â”€ desktop/                  # æ¡Œé¢åº”ç”¨æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ DESKTOP_APP_GUIDE.md  # ä½¿ç”¨æŒ‡å—
â”‚   â”‚   â”œâ”€â”€ PACKAGING_QUICKSTART.md # æ‰“åŒ…å¿«é€Ÿå…¥é—¨
â”‚   â”‚   â””â”€â”€ FIX_*.md              # é—®é¢˜ä¿®å¤æ–‡æ¡£
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ dist/                         # æ‰“åŒ…è¾“å‡ºï¼ˆç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ WxPublicCrawler.app       # macOS åº”ç”¨åŒ…
â”‚   â””â”€â”€ WxPublicCrawler/          # ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
â”‚       â”œâ”€â”€ _internal/            # ä¾èµ–æ–‡ä»¶
â”‚       â””â”€â”€ WxPublicCrawler       # å¯æ‰§è¡Œæ–‡ä»¶
â”‚
â”œâ”€â”€ run_desktop.py                # âœ¨ æ¡Œé¢åº”ç”¨å…¥å£
â”œâ”€â”€ wx_crawler.spec               # âœ¨ PyInstaller é…ç½®
â”œâ”€â”€ requirements.txt              # Python ä¾èµ–
â”œâ”€â”€ QUICK_REFERENCE.md            # å¿«é€Ÿå‚è€ƒ
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
```

### 5.1 ç”¨æˆ·æ•°æ®ç›®å½•

æ‰“åŒ…åçš„åº”ç”¨æ•°æ®ä¿å­˜åœ¨ç³»ç»Ÿæ ‡å‡†ä½ç½®ï¼š

**macOS**ï¼š
```
~/Library/
â”œâ”€â”€ Application Support/
â”‚   â””â”€â”€ WxPublicCrawler/
â”‚       â”œâ”€â”€ wxpublic.db          # SQLite æ•°æ®åº“
â”‚       â”œâ”€â”€ temp/                # ä¸´æ—¶æ–‡ä»¶
â”‚       â”‚   â””â”€â”€ qrcode.png       # ç™»å½•äºŒç»´ç 
â”‚       â””â”€â”€ app.lock             # å•å®ä¾‹é”æ–‡ä»¶
â””â”€â”€ Logs/
    â””â”€â”€ WxPublicCrawler/
        â””â”€â”€ app_YYYYMMDD_HHMMSS.log  # åº”ç”¨æ—¥å¿—
```

**Windows**ï¼š
```
%USERPROFILE%/
â”œâ”€â”€ AppData/
â”‚   â””â”€â”€ Local/
â”‚       â””â”€â”€ WxPublicCrawler/
â”‚           â”œâ”€â”€ wxpublic.db      # SQLite æ•°æ®åº“
â”‚           â”œâ”€â”€ temp/            # ä¸´æ—¶æ–‡ä»¶
â”‚           â””â”€â”€ Logs/            # åº”ç”¨æ—¥å¿—
```

## 6. ä½¿ç”¨æŒ‡å—

### 6.1 å¼€å‘ç¯å¢ƒè¿è¡Œ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt
cd web && npm install

# 2. æ„å»ºå‰ç«¯
cd web && npm run build:only

# 3. è¿è¡Œæ¡Œé¢åº”ç”¨
python run_desktop.py
```

### 6.2 æ‰“åŒ…åº”ç”¨

**macOS**ï¼š

```bash
# æ–¹å¼1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
script/desktop/build_mac.sh

# æ–¹å¼2ï¼šæ‰‹åŠ¨æ‰“åŒ…
cd web && npm run build:only && cd ..
pyinstaller wx_crawler.spec
```

**Windows**ï¼š

```batch
REM æ–¹å¼1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
script\desktop\build_windows.bat

REM æ–¹å¼2ï¼šæ‰‹åŠ¨æ‰“åŒ…
cd web && npm run build:only && cd ..
pyinstaller wx_crawler.spec
```

### 6.3 æµ‹è¯•æ‰“åŒ…ç»“æœ

```bash
# æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
script/desktop/test_app.sh

# æŸ¥çœ‹æ—¥å¿—
script/desktop/view_logs.sh

# æ¸…ç†åº”ç”¨
script/desktop/kill_app.sh
```

### 6.4 å¯åŠ¨åº”ç”¨

**å›¾å½¢ç•Œé¢å¯åŠ¨**ï¼ˆæ¨èï¼‰ï¼š

```bash
# macOS
open dist/WxPublicCrawler.app

# Windows
dist\WxPublicCrawler\WxPublicCrawler.exe
```

**ç»ˆç«¯å¯åŠ¨**ï¼ˆè°ƒè¯•ç”¨ï¼‰ï¼š

```bash
# macOS/Linux
./dist/WxPublicCrawler/WxPublicCrawler

# Windows
dist\WxPublicCrawler\WxPublicCrawler.exe
```

## 7. å…³é”®æŠ€æœ¯ç‚¹

### 7.1 ç¯å¢ƒéš”ç¦»

```python
# run_desktop.py å¼€å¤´
os.environ['ENV'] = 'desktop'        # æ¡Œé¢ç¯å¢ƒ
os.environ['DB_DRIVER'] = 'sqlite'   # ä½¿ç”¨ SQLite
```

### 7.2 å•å®ä¾‹æ§åˆ¶

```python
# ä½¿ç”¨æ–‡ä»¶é”é˜²æ­¢å¤šå¼€
from filelock import FileLock

lock_file = get_lock_file_path()
lock = FileLock(lock_file, timeout=0)

try:
    lock.acquire(blocking=False)
    # å¯åŠ¨åº”ç”¨...
except Timeout:
    print("åº”ç”¨å·²åœ¨è¿è¡Œ")
    sys.exit(1)
```

### 7.3 æ–‡ä»¶ç³»ç»Ÿé€‚é…

```python
# app/utils/src_path.py
def get_writable_dir(subdir='temp'):
    """è·å–å¯å†™ç›®å½•"""
    if platform.system() == 'Darwin':  # macOS
        base = '~/Library/Application Support/WxPublicCrawler'
    elif platform.system() == 'Windows':
        base = '~/AppData/Local/WxPublicCrawler'
    else:  # Linux
        base = '~/.local/share/WxPublicCrawler'
    
    path = os.path.expanduser(base)
    os.makedirs(os.path.join(path, subdir), exist_ok=True)
    return os.path.join(path, subdir)
```

### 7.4 æ•°æ®åº“è‡ªåŠ¨åˆ›å»º

```python
# app/db/sqlalchemy_db.py
if driver == 'sqlite':
    # SQLite è‡ªåŠ¨åˆ›å»ºè¡¨ç»“æ„
    Base.metadata.create_all(self._engine)
```

## 8. å¸¸è§é—®é¢˜

### 8.1 åº”ç”¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼šåŒå‡» `.app` åç«‹å³é€€å‡º

**æ’æŸ¥**ï¼š

```bash
# 1. æŸ¥çœ‹æ—¥å¿—
script/desktop/view_logs.sh

# 2. ç»ˆç«¯å¯åŠ¨æŸ¥çœ‹é”™è¯¯
./dist/WxPublicCrawler/WxPublicCrawler

# 3. æ£€æŸ¥ç«¯å£å ç”¨
lsof -ti:18000

# 4. æ¸…ç†å¹¶é‡å¯
script/desktop/kill_app.sh
open dist/WxPublicCrawler.app
```

### 8.2 ç«¯å£è¢«å ç”¨

**é”™è¯¯**ï¼š`[Errno 48] address already in use`

**è§£å†³**ï¼š

```bash
# ç»ˆæ­¢å ç”¨è¿›ç¨‹
script/desktop/kill_app.sh

# æˆ–æ‰‹åŠ¨ç»ˆæ­¢
lsof -ti:18000 | xargs kill -9
```

### 8.3 æ•°æ®åº“é”™è¯¯

**é”™è¯¯**ï¼š`NotSupportedError: Authentication plugin`

**åŸå› **ï¼šå°è¯•ä½¿ç”¨ MySQL é©±åŠ¨

**è§£å†³**ï¼šç¡®ä¿ `run_desktop.py` ä¸­è®¾ç½®äº† `DB_DRIVER=sqlite`

### 8.4 æ–‡ä»¶å†™å…¥å¤±è´¥

**é”™è¯¯**ï¼š`[Errno 30] Read-only file system`

**åŸå› **ï¼šå°è¯•åœ¨ `.app` åŒ…å†…å†™å…¥æ–‡ä»¶

**è§£å†³**ï¼šä½¿ç”¨ `get_temp_file_path()` æˆ– `get_writable_dir()`

## 9. æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **å®‰è£…åŒ…å¤§å°** | ~50MB (macOS), ~60MB (Windows) |
| **é¦–æ¬¡å¯åŠ¨æ—¶é—´** | 3-5ç§’ |
| **å†…å­˜å ç”¨** | ~150MB |
| **CPU å ç”¨** | é—²ç½® <1%, å·¥ä½œ 5-10% |
| **ç£ç›˜å ç”¨** | æ•°æ®åº“ <10MB (å–å†³äºä½¿ç”¨é‡) |

## 10. æœªæ¥è§„åˆ’

- [ ] æ”¯æŒæ‰¹é‡ä¸‹è½½æ–‡ç« 
- [ ] æ·»åŠ æ–‡ç« æœç´¢åŠŸèƒ½
- [ ] æ”¯æŒå¤šè´¦å·ç®¡ç†
- [ ] æ·»åŠ æ–‡ç« å¯¼å‡ºåŠŸèƒ½ï¼ˆPDF/Markdownï¼‰
- [ ] ä¼˜åŒ–äºŒç»´ç ç™»å½•ä½“éªŒ
- [ ] æ·»åŠ è‡ªåŠ¨æ›´æ–°åŠŸèƒ½
- [ ] æ”¯æŒ Linux æ‰“åŒ…

## 11. ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [QUICK_REFERENCE.md](QUICK_REFERENCE.md) | å¿«é€Ÿå‚è€ƒå¡ç‰‡ |
| [docs/desktop/DESKTOP_APP_GUIDE.md](docs/desktop/DESKTOP_APP_GUIDE.md) | å®Œæ•´ä½¿ç”¨æŒ‡å— |
| [docs/desktop/PACKAGING_QUICKSTART.md](docs/desktop/PACKAGING_QUICKSTART.md) | æ‰“åŒ…å¿«é€Ÿå…¥é—¨ |
| [script/desktop/README.md](script/desktop/README.md) | è„šæœ¬ä½¿ç”¨è¯´æ˜ |
| [script/desktop/MIGRATION_SUMMARY.md](script/desktop/MIGRATION_SUMMARY.md) | è„šæœ¬è¿ç§»æ€»ç»“ |

## 12. æŠ€æœ¯æ”¯æŒ

- **é—®é¢˜åé¦ˆ**ï¼šGitHub Issues
- **æ–‡æ¡£æ›´æ–°**ï¼šæŒç»­ç»´æŠ¤ä¸­
- **ç‰ˆæœ¬å†å²**ï¼šå‚è§ Git æäº¤è®°å½•

---

**å¼€å‘å›¢é˜Ÿ**: wxPublicCrawl Team  
**æœ€åæ›´æ–°**: 2025-12-22  
**è®¸å¯è¯**: MIT
