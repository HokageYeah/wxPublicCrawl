#!/bin/bash
# ============================================================================
# 脚本名称: view_logs.sh
# 功能说明: 实时查看桌面应用的最新日志
# 工作原理: 
#   1. 定位日志目录（macOS 标准日志位置）
#   2. 查找最新的日志文件（按修改时间排序）
#   3. 使用 tail -f 实时滚动显示日志内容
# ============================================================================

# ============================================================================
# 第一步：设置日志目录路径
# ============================================================================
# $HOME 是用户主目录的环境变量（例如：/Users/yuye）
# macOS 标准日志目录为：~/Library/Logs/应用名称
# 这是 Apple 推荐的应用日志存储位置
LOG_DIR="$HOME/Library/Logs/wx公众号工具"

# ============================================================================
# 第二步：确保日志目录存在
# ============================================================================
# mkdir -p: 
#   -p 参数表示递归创建目录（如果父目录不存在也会创建）
#   如果目录已存在，不会报错，直接跳过
mkdir -p "$LOG_DIR"

# 输出日志目录路径，方便用户确认
echo "日志目录: $LOG_DIR"
echo ""  # 空行，让输出更清晰

# ============================================================================
# 第三步：查找最新的日志文件
# ============================================================================
# 这一行是整个脚本的核心，分解如下：
# 
# ls -t "$LOG_DIR"/app_*.log
#   - ls: 列出文件
#   - -t: 按修改时间排序（最新的在前）
#   - "$LOG_DIR"/app_*.log: 匹配目录下所有以 app_ 开头，.log 结尾的文件
#   - 例如：app_20251222_163845.log
#
# 2>/dev/null
#   - 2> 表示重定向标准错误输出（stderr）
#   - /dev/null 是一个特殊文件，相当于"黑洞"，丢弃所有写入的内容
#   - 作用：如果没有找到日志文件，不显示错误信息
#
# | head -1
#   - | 是管道符，将前一个命令的输出传给下一个命令
#   - head -1: 只取第一行（即最新的日志文件）
#
# LATEST=$(...)
#   - $(...) 是命令替换，执行括号内的命令并将结果赋值给变量
#   - 最终 LATEST 变量保存了最新日志文件的完整路径
LATEST=$(ls -t "$LOG_DIR"/app_*.log 2>/dev/null | head -1)

# ============================================================================
# 第四步：检查是否找到日志文件
# ============================================================================
# [ -n "$LATEST" ]
#   - [ ] 是测试命令（test）
#   - -n: 测试字符串是否非空（not empty）
#   - 如果找到了日志文件，$LATEST 非空，条件为真
if [ -n "$LATEST" ]; then
    # --------------------------------------------------------------------
    # 情况1：找到了日志文件
    # --------------------------------------------------------------------
    echo "查看日志: $LATEST"
    echo ""  # 空行分隔
    
    # tail -f: 实时查看文件内容
    #   - tail: 显示文件末尾内容（默认最后10行）
    #   - -f: follow 模式，持续监控文件变化并实时显示新增内容
    #   - 按 Ctrl+C 退出
    # 
    # 工作原理：
    #   tail -f 会一直运行，每当日志文件有新内容写入时，立即显示到终端
    #   这样可以实时看到应用的运行状态和错误信息
    tail -f "$LATEST"
else
    # --------------------------------------------------------------------
    # 情况2：没有找到日志文件
    # --------------------------------------------------------------------
    echo "没有日志文件"
    echo ""
    echo "提示："
    echo "  1. 确保已运行过桌面应用（open dist/wx公众号工具.app ）"
    echo "  2. 检查日志目录：$LOG_DIR"
fi

# ============================================================================
# 使用方法
# ============================================================================
# 1. 赋予执行权限：chmod +x view_logs.sh
# 2. 运行脚本：./view_logs.sh
# 3. 按 Ctrl+C 退出日志查看
#
# 原理总结：
#   - 使用 macOS 标准日志目录确保日志持久化
#   - 按时间排序找到最新日志，适合快速调试
#   - tail -f 实时监控，无需刷新或重新运行命令
# ============================================================================
