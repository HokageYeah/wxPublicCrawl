# AIåŠ©æ‰‹æ¶æ„è¯´æ˜

## ğŸ“ æ•´ä½“æ¶æ„

AIåŠ©æ‰‹ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œé¿å…å¾ªç¯ä¾èµ–ï¼Œå®ç°äº†AIä¸MCPå·¥å…·çš„æ— ç¼é›†æˆã€‚

### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Application)                    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI (app/main.py)                                 â”‚  â”‚
â”‚  â”‚  - lifespanäº‹ä»¶: å¯åŠ¨æ—¶è°ƒç”¨init_ai_assistant()        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APIå±‚ (API Endpoints)                       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ai_assistant.py                                       â”‚  â”‚
â”‚  â”‚  - init_ai_assistant(): åˆå§‹åŒ–å…¨å±€è¿æ¥å™¨              â”‚  â”‚
â”‚  â”‚  - get_connector(): è·å–å…¨å±€è¿æ¥å™¨å®ä¾‹                â”‚  â”‚
â”‚  â”‚  - /query: å¤„ç†ç”¨æˆ·æŸ¥è¯¢                                â”‚  â”‚
â”‚  â”‚  - /clear-history: æ¸…ç©ºå†å²                            â”‚  â”‚
â”‚  â”‚  - /stats: è·å–ç»Ÿè®¡ä¿¡æ¯                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                   â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               æ ¸å¿ƒè¿æ¥å™¨å±‚ (Core Connector)                   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MCPLLMConnect (app/ai/llm/mcp_llm_connect.py)        â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  æ ¸å¿ƒåŠŸèƒ½:                                             â”‚  â”‚
â”‚  â”‚  - æ•´åˆAIå®¢æˆ·ç«¯å’ŒMCPç®¡ç†å™¨                            â”‚  â”‚
â”‚  â”‚  - å®ç°Function Callingæœºåˆ¶                           â”‚  â”‚
â”‚  â”‚  - å¤„ç†å·¥å…·è°ƒç”¨å¾ªç¯                                   â”‚  â”‚
â”‚  â”‚  - ç®¡ç†å¯¹è¯å†å²å’Œä¸Šä¸‹æ–‡                               â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  ä¸»è¦æ–¹æ³•:                                             â”‚  â”‚
â”‚  â”‚  - __init__(): åŒæ­¥åˆ›å»ºå®ä¾‹                           â”‚  â”‚
â”‚  â”‚  - async_init(): å¼‚æ­¥åˆå§‹åŒ–ï¼ˆè¿æ¥MCPæœåŠ¡å™¨ï¼‰         â”‚  â”‚
â”‚  â”‚  - query(): å‘é€æŸ¥è¯¢å¹¶å¤„ç†å·¥å…·è°ƒç”¨                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                        â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚  â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AIå®¢æˆ·ç«¯å±‚      â”‚ â”‚   MCPç®¡ç†å™¨å±‚        â”‚ â”‚  å‡½æ•°å¤„ç†å±‚     â”‚
â”‚  (AI Client)     â”‚ â”‚ (MCP Manager)        â”‚ â”‚ (Function)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AIClient         â”‚ â”‚ MCPClientManager     â”‚ â”‚ FunctionHandlerâ”‚
â”‚                  â”‚ â”‚                      â”‚ â”‚                â”‚
â”‚ åŠŸèƒ½:            â”‚ â”‚ åŠŸèƒ½:                â”‚ â”‚ åŠŸèƒ½:          â”‚
â”‚ - OpenAI APIè°ƒç”¨ â”‚ â”‚ - ç®¡ç†å¤šä¸ªMCPå®¢æˆ·ç«¯  â”‚ â”‚ - æœ¬åœ°å‡½æ•°æ³¨å†Œ â”‚
â”‚ - å¯¹è¯å†å²ç®¡ç†   â”‚ â”‚ - åŠ è½½é…ç½®æ–‡ä»¶       â”‚ â”‚ - å‡½æ•°è°ƒç”¨å¤„ç† â”‚
â”‚ - æµå¼å“åº”       â”‚ â”‚ - è¿æ¥MCPæœåŠ¡å™¨      â”‚ â”‚ - ç³»ç»Ÿæ§åˆ¶     â”‚
â”‚ - å‚æ•°é…ç½®       â”‚ â”‚ - å·¥å…·åˆ—è¡¨ç®¡ç†       â”‚ â”‚                â”‚
â”‚                  â”‚ â”‚ - å·¥å…·è°ƒç”¨ä»£ç†       â”‚ â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                     â”‚
          â”‚                      â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº•å±‚ä¾èµ– (Dependencies)                  â”‚
â”‚                                                               â”‚
â”‚  - OpenAI SDK (AsyncOpenAI)                                  â”‚
â”‚  - FastMCP Client (HTTP/STDIOä¼ è¾“)                           â”‚
â”‚  - Loguru (æ—¥å¿—)                                              â”‚
â”‚  - Pydantic (æ•°æ®éªŒè¯)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ åˆå§‹åŒ–æµç¨‹è¯¦è§£

### 1. åº”ç”¨å¯åŠ¨é˜¶æ®µ (`app/main.py`)

```python
@asynccontextmanager
async def lifespan(app: FastAPI):
    # åº”ç”¨å¯åŠ¨æ—¶
    await init_ai_assistant(llm_conn=None)
    yield
    # åº”ç”¨å…³é—­æ—¶çš„æ¸…ç†é€»è¾‘
```

### 2. AIåŠ©æ‰‹åˆå§‹åŒ– (`app/api/endpoints/ai_assistant.py`)

```python
async def init_ai_assistant(llm_conn=None):
    global _global_connector
    
    # æ­¥éª¤1: åˆ›å»ºè¿æ¥å™¨å®ä¾‹ï¼ˆåŒæ­¥ï¼‰
    _global_connector = MCPLLMConnect()
    
    # æ­¥éª¤2: å¼‚æ­¥åˆå§‹åŒ–
    init_success = await _global_connector.async_init()
```

**å…³é”®è®¾è®¡ç‚¹ï¼š**
- å°†åˆå§‹åŒ–åˆ†ä¸º**åŒæ­¥åˆ›å»º**å’Œ**å¼‚æ­¥åˆå§‹åŒ–**ä¸¤ä¸ªé˜¶æ®µ
- é¿å…äº†å¾ªç¯ä¾èµ–é—®é¢˜
- å…è®¸çµæ´»çš„é”™è¯¯å¤„ç†

### 3. è¿æ¥å™¨åˆ›å»º (`app/ai/llm/mcp_llm_connect.py`)

```python
def __init__(self, mcp_manager=None, ai_client=None, ...):
    # å¦‚æœæœªæä¾›mcp_managerï¼Œåˆ›å»ºæ–°å®ä¾‹å¹¶ä¼ å…¥self
    self.mcp_manager = mcp_manager or MCPClientManager(self)
    
    # å¦‚æœæœªæä¾›ai_clientï¼Œåˆ›å»ºé»˜è®¤å®ä¾‹
    self.ai_client = ai_client or AIClient(enable_history=True)
    
    # åˆ›å»ºå‡½æ•°å¤„ç†å™¨
    self.func_handler = FunctionHandler(self)
```

**è§£å†³å¾ªç¯ä¾èµ–çš„å…³é”®ï¼š**
- `MCPClientManager` æ¥æ”¶ `llm_conn` å‚æ•°ï¼ˆå³ `MCPLLMConnect` å®ä¾‹ï¼‰
- ä½†è¿™ä¸ªå…³è”åœ¨ `__init__` é˜¶æ®µå»ºç«‹ï¼Œä¸éœ€è¦å®Œå…¨åˆå§‹åŒ–
- å®é™…çš„MCPè¿æ¥åœ¨ `async_init()` é˜¶æ®µå®Œæˆ

### 4. å¼‚æ­¥åˆå§‹åŒ– (`app/ai/llm/mcp_llm_connect.py`)

```python
async def async_init(self):
    # 1. åˆå§‹åŒ–MCPå®¢æˆ·ç«¯ï¼ˆè¿æ¥åˆ°MCPæœåŠ¡å™¨ï¼‰
    init_success = await self.mcp_manager.init_mcp_clients()
    
    # 2. åŠ è½½å·¥å…·åˆ—è¡¨
    all_tools = self.mcp_manager.get_all_tools()
    
    # 3. æ³¨å†Œå·¥å…·åˆ°AIå®¢æˆ·ç«¯ï¼ˆä¸ºFunction Callingå‡†å¤‡ï¼‰
    # ... å·¥å…·æ³¨å†Œé€»è¾‘ ...
    
    return init_success
```

### 5. MCPå®¢æˆ·ç«¯åˆå§‹åŒ– (`app/ai/mcp/mcp_client/client_manager.py`)

```python
async def init_mcp_clients(self):
    # 1. åŠ è½½é…ç½®æ–‡ä»¶
    self.load_config()
    
    # 2. ä¸ºæ¯ä¸ªé…ç½®çš„æœåŠ¡å™¨åˆ›å»ºå®¢æˆ·ç«¯
    for name, config in self.config["mcpServer"].items():
        client = FastMCPClient(name=name, **config)
        await client.connect()
        self.clients[name] = client
    
    # 3. æ”¶é›†æ‰€æœ‰å·¥å…·
    for client in self.clients.values():
        tools = await client.list_tools()
        self.tools.extend(tools)
```

## ğŸ¯ å…³é”®ç»„ä»¶è¯´æ˜

### MCPLLMConnect (æ ¸å¿ƒè¿æ¥å™¨)

**èŒè´£ï¼š**
- ä½œä¸ºAIå’ŒMCPå·¥å…·ä¹‹é—´çš„æ¡¥æ¢
- å®ç°æ™ºèƒ½å·¥å…·è°ƒç”¨å†³ç­–
- ç®¡ç†å¯¹è¯æµç¨‹å’Œä¸Šä¸‹æ–‡

**æ ¸å¿ƒæ–¹æ³•ï¼š**
- `__init__()`: åŒæ­¥åˆ›å»ºå®ä¾‹ï¼Œå»ºç«‹ç»„ä»¶å…³è”
- `async_init()`: å¼‚æ­¥åˆå§‹åŒ–ï¼Œè¿æ¥å¤–éƒ¨æœåŠ¡
- `query()`: å¤„ç†ç”¨æˆ·æŸ¥è¯¢ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·
- `_conversation_loop()`: ç®¡ç†AIä¸å·¥å…·çš„äº¤äº’å¾ªç¯

### AIClient (AIå®¢æˆ·ç«¯)

**èŒè´£ï¼š**
- å°è£…OpenAI APIè°ƒç”¨
- ç®¡ç†å¯¹è¯å†å²
- æä¾›ç»Ÿä¸€çš„AIæ¥å£

**æ ¸å¿ƒæ–¹æ³•ï¼š**
- `chat()`: å•æ¬¡å¯¹è¯
- `stream_chat()`: æµå¼å“åº”
- `chat_with_function_calling()`: å¸¦å·¥å…·è°ƒç”¨çš„å¯¹è¯

### MCPClientManager (MCPç®¡ç†å™¨)

**èŒè´£ï¼š**
- ç®¡ç†å¤šä¸ªMCPå®¢æˆ·ç«¯è¿æ¥
- åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶
- æä¾›ç»Ÿä¸€çš„å·¥å…·è®¿é—®æ¥å£

**æ ¸å¿ƒæ–¹æ³•ï¼š**
- `init_mcp_clients()`: åˆå§‹åŒ–æ‰€æœ‰MCPå®¢æˆ·ç«¯
- `get_all_tools()`: è·å–æ‰€æœ‰å¯ç”¨å·¥å…·
- `call_tool()`: è°ƒç”¨æŒ‡å®šå·¥å…·

### FunctionHandler (å‡½æ•°å¤„ç†å™¨)

**èŒè´£ï¼š**
- ç®¡ç†æœ¬åœ°æ³¨å†Œçš„å‡½æ•°
- å¤„ç†å‡½æ•°è°ƒç”¨è¯·æ±‚
- æä¾›ç³»ç»Ÿæ§åˆ¶åŠŸèƒ½

**æ ¸å¿ƒæ–¹æ³•ï¼š**
- `get_functions()`: è·å–æ‰€æœ‰æ³¨å†Œçš„å‡½æ•°
- `handle_llm_function_call()`: å¤„ç†LLMçš„å‡½æ•°è°ƒç”¨è¯·æ±‚

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½® (`.env`)

```bash
# AIé…ç½®
AI_API_KEY=your_openai_api_key
AI_BASE_URL=https://api.openai.com/v1
AI_MODEL=gpt-4-turbo-preview
```

### MCPé…ç½® (`app/ai/mcp/mcp_client/mcp_settings.json`)

```json
{
    "mcp_server_url": "http://localhost:8008/mcp",
    "mcpServer": {
        "fastmcp-demo-tools": {
            "transport": "streamable-http",
            "url": "http://localhost:8008/mcp",
            "description": "FastMCP Server å¤©æ°”ã€çŸ¥è¯†åº“æµ‹è¯•"
        }
    }
}
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å¯¹è¯

```python
from app.ai.llm.mcp_llm_connect import MCPLLMConnect

# åˆ›å»ºå¹¶åˆå§‹åŒ–
connector = MCPLLMConnect()
await connector.async_init()

# åŸºæœ¬å¯¹è¯
response = await connector.query(
    user_message="ä½ å¥½",
    system_message="ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹"
)
print(response)
```

### å¸¦å·¥å…·è°ƒç”¨çš„å¯¹è¯

```python
# AIä¼šè‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·
response = await connector.query(
    user_message="æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”",
    system_message="ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚å½“ç”¨æˆ·éœ€è¦æŸ¥è¯¢å¤©æ°”æ—¶ï¼Œä½¿ç”¨weatherå·¥å…·ã€‚"
)
# AIä¼šï¼š
# 1. è¯†åˆ«éœ€è¦æŸ¥è¯¢å¤©æ°”
# 2. è°ƒç”¨weatherå·¥å…·
# 3. å¤„ç†å·¥å…·è¿”å›ç»“æœ
# 4. ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤
```

### å¤šè½®å¯¹è¯

```python
# ç¬¬ä¸€è½®
response1 = await connector.query("å¸®æˆ‘è®¡ç®— 123 * 456")

# ç¬¬äºŒè½®ï¼ˆä¿ç•™ä¸Šä¸‹æ–‡ï¼‰
response2 = await connector.query("å†ä¹˜ä»¥2")
```

## ğŸ› æ•…éšœæ’æŸ¥

### åˆå§‹åŒ–å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
1. MCPæœåŠ¡å™¨æœªå¯åŠ¨
2. é…ç½®æ–‡ä»¶é”™è¯¯
3. APIå¯†é’¥æ— æ•ˆ
4. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. å¯åŠ¨MCPæœåŠ¡å™¨
python app/ai/mcp/mcp_server/fastmcp_server.py

# 2. æ£€æŸ¥é…ç½®
python app/ai/test/check_ai_config.py

# 3. æŸ¥çœ‹æ—¥å¿—
# æ—¥å¿—æ ‡ç­¾: [AI_ASSISTANT_API], [MCP_LLM_CONNECT], [MCP_MANAGER]
```

### å·¥å…·è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
1. å·¥å…·æœªæ­£ç¡®æ³¨å†Œ
2. MCPæœåŠ¡å™¨è¿æ¥æ–­å¼€
3. å·¥å…·å‚æ•°é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# æ£€æŸ¥å¯ç”¨å·¥å…·
connector = get_connector()
stats = connector.get_stats()
print(stats)

# æŸ¥çœ‹MCPå®¢æˆ·ç«¯çŠ¶æ€
mcp_manager = connector.mcp_manager
status = mcp_manager.get_status()
print(status)
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¯¹è¯å†å²ç®¡ç†**
   - è®¾ç½®åˆç†çš„ `max_history` å€¼ï¼ˆé»˜è®¤20è½®ï¼‰
   - å®šæœŸæ¸…ç†å†å²ï¼š`connector.clear_history()`

2. **å·¥å…·è°ƒç”¨é™åˆ¶**
   - è®¾ç½® `max_tool_calls` é˜²æ­¢æ— é™å¾ªç¯ï¼ˆé»˜è®¤10æ¬¡ï¼‰
   - ç›‘æ§å·¥å…·è°ƒç”¨ç»Ÿè®¡

3. **å¹¶å‘å¤„ç†**
   - ä½¿ç”¨è¿æ¥æ± ç®¡ç†å¤šä¸ªç”¨æˆ·ä¼šè¯
   - è€ƒè™‘ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºç‹¬ç«‹çš„è¿æ¥å™¨å®ä¾‹

4. **ç¼“å­˜ç­–ç•¥**
   - ç¼“å­˜å¸¸ç”¨å·¥å…·çš„ç»“æœ
   - ä½¿ç”¨Rediså­˜å‚¨å¯¹è¯å†å²

## ğŸ” å®‰å…¨å»ºè®®

1. **APIå¯†é’¥ç®¡ç†**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
   - ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

2. **è¾“å…¥éªŒè¯**
   - éªŒè¯ç”¨æˆ·è¾“å…¥é•¿åº¦å’Œæ ¼å¼
   - é˜²æ­¢æ³¨å…¥æ”»å‡»

3. **è®¿é—®æ§åˆ¶**
   - å®ç°ç”¨æˆ·è®¤è¯å’Œæˆæƒ
   - é™åˆ¶APIè°ƒç”¨é¢‘ç‡

## ğŸ“š æ‰©å±•æ–¹å‘

1. **å‘é‡æ•°æ®åº“é›†æˆ**
   - æ¥å…¥Pineconeã€Weaviateç­‰
   - å®ç°RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

2. **å¤šæ¨¡æ€æ”¯æŒ**
   - å›¾ç‰‡ç†è§£å’Œç”Ÿæˆ
   - è¯­éŸ³è¾“å…¥è¾“å‡º

3. **è®°å¿†ç³»ç»Ÿ**
   - é•¿æœŸè®°å¿†å­˜å‚¨
   - ç”¨æˆ·åå¥½å­¦ä¹ 

4. **å·¥å…·å¸‚åœº**
   - åŠ¨æ€åŠ è½½å·¥å…·æ’ä»¶
   - å·¥å…·ç‰ˆæœ¬ç®¡ç†

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**æœ€åæ›´æ–°ï¼š** 2025-12-30  
**ç»´æŠ¤è€…ï¼š** AI Development Team

