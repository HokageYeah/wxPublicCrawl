# æ‰“åŒ…åæç¤ºè¯æ–‡ä»¶æ‰¾ä¸åˆ° - è§£å†³æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æè¿°

æ‰“åŒ…æˆæ¡Œé¢ç¨‹åºåï¼Œè¿è¡Œæ—¶æç¤ºï¼š

```
æç¤ºè¯ç›®å½•ä¸å­˜åœ¨: app/ai/prompt
æç¤ºè¯æ–‡ä»¶ä¸å­˜åœ¨: app/ai/prompt/education_prompt.txt
```

## ğŸ“‹ é—®é¢˜åŸå› 

æ‰“åŒ…åï¼Œèµ„æºæ–‡ä»¶çš„è·¯å¾„éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚PyInstaller ä¼šå°†èµ„æºæ–‡ä»¶æå–åˆ°ä¸´æ—¶ç›®å½• `sys._MEIPASS`ï¼Œéœ€è¦ä½¿ç”¨ `get_resource_path()` å‡½æ•°æ¥è·å–æ­£ç¡®çš„è·¯å¾„ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### ç¬¬1æ­¥: ç¡®è®¤ä»£ç å·²ä¿®å¤ âœ“

å·²ä¿®å¤çš„æ–‡ä»¶ï¼š

1. **`app/ai/utils/prompt_manager.py`**
   - è‡ªåŠ¨å¤„ç†ç›¸å¯¹è·¯å¾„ï¼Œä½¿ç”¨ `get_resource_path()` è½¬æ¢
   - æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—

2. **`app/ai/code/education_analyze.py`**
   - ä½¿ç”¨é»˜è®¤è·¯å¾„ï¼ˆè‡ªåŠ¨å¤„ç†æ‰“åŒ…ï¼‰

3. **`app/utils/src_path.py`**
   - æ”¹è¿› `get_resource_path()` å‡½æ•°çš„æ—¥å¿—è¾“å‡º
   - æ›´å¥½çš„è°ƒè¯•ä¿¡æ¯

### ç¬¬2æ­¥: éªŒè¯æ‰“åŒ…é…ç½®

æ£€æŸ¥ `wx_crawler.spec` æ–‡ä»¶ï¼Œç¡®ä¿åŒ…å«æç¤ºè¯æ–‡ä»¶ï¼š

```python
datas=[
    ('web/dist', 'web/dist'),
    ('app/ai/prompt', 'app/ai/prompt'),  # âœ… è¿™ä¸€è¡Œå¾ˆé‡è¦
    ('.env', '.'),
    ('.env.desktop', '.'),
],
```

### ç¬¬3æ­¥: é‡æ–°æ‰“åŒ…

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd /Users/yuye/YeahWork/Pythoné¡¹ç›®/wxPublicCrawl

# macOS æ‰“åŒ…
./script/desktop/build_mac.sh

# æˆ–ä½¿ç”¨ PyInstaller ç›´æ¥æ‰“åŒ…
pyinstaller wx_crawler.spec --clean
```

### ç¬¬4æ­¥: éªŒè¯æ‰“åŒ…ç»“æœ

#### æ–¹æ³•1: ä½¿ç”¨è¯Šæ–­å·¥å…·ï¼ˆæ¨èï¼‰

```bash
# åœ¨æ‰“åŒ…åçš„åº”ç”¨ä¸­è¿è¡Œè¯Šæ–­å·¥å…·
# macOS:
./dist/wxå…¬ä¼—å·å·¥å…·/wxå…¬ä¼—å·å·¥å…· &
# ç„¶ååœ¨åº”ç”¨ä¸­è°ƒç”¨æµ‹è¯•è„šæœ¬

# æˆ–ç›´æ¥åœ¨æ‰“åŒ…å‰çš„ç¯å¢ƒæµ‹è¯•
python app/ai/test/test_resource_path.py
```

è¿™ä¼šæ˜¾ç¤ºï¼š
- âœ… èµ„æºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… è·¯å¾„è§£ææ˜¯å¦æ­£ç¡®
- âœ… æç¤ºè¯ç®¡ç†å™¨æ˜¯å¦æ­£å¸¸

#### æ–¹æ³•2: æ‰‹åŠ¨æ£€æŸ¥æ‰“åŒ…ç›®å½•

```bash
# macOS
cd dist/wxå…¬ä¼—å·å·¥å…·/
ls -la _internal/app/ai/prompt/

# Windows
cd dist\wxå…¬ä¼—å·å·¥å…·\
dir _internal\app\ai\prompt\

# åº”è¯¥èƒ½çœ‹åˆ°:
# education_prompt.txt
```

### ç¬¬5æ­¥: æŸ¥çœ‹è¿è¡Œæ—¥å¿—

å¯åŠ¨æ¡Œé¢åº”ç”¨åï¼ŒæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼ˆåœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼‰ï¼š

```bash
# macOS
./dist/wxå…¬ä¼—å·å·¥å…·/wxå…¬ä¼—å·å·¥å…·

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼çš„æ—¥å¿—:
# ğŸ“¦ [æ‰“åŒ…æ¨¡å¼] sys._MEIPASS: /private/var/folders/...
# ğŸ“„ [æ‰“åŒ…æ¨¡å¼] èµ„æºè·¯å¾„è§£æ:
#    ç›¸å¯¹è·¯å¾„: app/ai/prompt
#    å®Œæ•´è·¯å¾„: /private/var/.../app/ai/prompt
#    æ–‡ä»¶å­˜åœ¨: âœ… æ˜¯
# âœ… æç¤ºè¯ç®¡ç†å™¨å·²åˆå§‹åŒ– - ç›®å½•: /private/var/.../app/ai/prompt
# æ‰¾åˆ° 1 ä¸ªæç¤ºè¯æ–‡ä»¶: ['education_prompt.txt']
```

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: æ‰“åŒ…åä»ç„¶æ‰¾ä¸åˆ°æ–‡ä»¶

**åŸå› **: `wx_crawler.spec` é…ç½®é”™è¯¯æˆ–æœªç”Ÿæ•ˆ

**è§£å†³**:
```bash
# æ¸…ç†æ—§çš„æ‰“åŒ…æ–‡ä»¶
rm -rf build/ dist/

# é‡æ–°æ‰“åŒ…
pyinstaller wx_crawler.spec --clean
```

### é—®é¢˜2: è·¯å¾„æ˜¾ç¤ºæ˜¯ç›¸å¯¹è·¯å¾„è€Œä¸æ˜¯ç»å¯¹è·¯å¾„

**åŸå› **: ä»£ç ç‰ˆæœ¬ä¸æ˜¯æœ€æ–°çš„

**è§£å†³**:
1. ç¡®è®¤ `app/ai/utils/prompt_manager.py` å·²æ›´æ–°
2. é‡æ–°æ‰“åŒ…
3. ç¡®ä¿è¿è¡Œçš„æ˜¯æ–°æ‰“åŒ…çš„ç‰ˆæœ¬

### é—®é¢˜3: å…¶ä»–èµ„æºæ–‡ä»¶ä¹Ÿæ‰¾ä¸åˆ°

**åŸå› **: å¯èƒ½æ˜¯ `get_resource_path()` å‡½æ•°æœ‰é—®é¢˜

**è§£å†³**:
1. è¿è¡Œè¯Šæ–­å·¥å…·: `python app/ai/test/test_resource_path.py`
2. æŸ¥çœ‹è¯¦ç»†çš„è·¯å¾„è§£ææ—¥å¿—
3. æ ¹æ®æ—¥å¿—è¾“å‡ºè°ƒæ•´

### é—®é¢˜4: å¼€å‘ç¯å¢ƒæ­£å¸¸ï¼Œæ‰“åŒ…åæœ‰é—®é¢˜

**åŸå› **: å¼€å‘ç¯å¢ƒå’Œæ‰“åŒ…ç¯å¢ƒçš„è·¯å¾„è§£ææ–¹å¼ä¸åŒ

**è§£å†³**:
1. è®¾ç½®ç¯å¢ƒå˜é‡ `ENV=desktop`
2. åœ¨å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿæ‰“åŒ…ç¯å¢ƒæµ‹è¯•:
   ```python
   import sys
   sys._MEIPASS = '/tmp/test'
   ```

## ğŸ“ éªŒè¯æ¸…å•

æ‰“åŒ…å‰æ£€æŸ¥ï¼š

- [ ] `wx_crawler.spec` ä¸­åŒ…å« `('app/ai/prompt', 'app/ai/prompt')`
- [ ] æç¤ºè¯æ–‡ä»¶å­˜åœ¨: `app/ai/prompt/education_prompt.txt`
- [ ] `prompt_manager.py` ä»£ç å·²æ›´æ–°
- [ ] `src_path.py` ä»£ç å·²æ›´æ–°

æ‰“åŒ…åæ£€æŸ¥ï¼š

- [ ] è¿è¡Œè¯Šæ–­å·¥å…·æ— æŠ¥é”™
- [ ] æ—¥å¿—æ˜¾ç¤º"æ‰“åŒ…æ¨¡å¼"
- [ ] æ—¥å¿—æ˜¾ç¤º"æç¤ºè¯ç®¡ç†å™¨å·²åˆå§‹åŒ–"
- [ ] æ—¥å¿—æ˜¾ç¤º"æ‰¾åˆ° N ä¸ªæç¤ºè¯æ–‡ä»¶"
- [ ] AIåˆ†æåŠŸèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

åœ¨è¿è¡Œæ‰“åŒ…åçš„åº”ç”¨æ—¶ï¼ŒæŸ¥çœ‹å®Œæ•´çš„æ§åˆ¶å°è¾“å‡ºï¼š

```bash
# macOS - åœ¨ç»ˆç«¯è¿è¡Œä»¥æŸ¥çœ‹æ—¥å¿—
./dist/wxå…¬ä¼—å·å·¥å…·/wxå…¬ä¼—å·å·¥å…·

# Windows - åœ¨ cmd è¿è¡Œ
dist\wxå…¬ä¼—å·å·¥å…·\wxå…¬ä¼—å·å·¥å…·.exe
```

### 2. æ£€æŸ¥æ‰“åŒ…åçš„æ–‡ä»¶ç»“æ„

```bash
# macOS
tree dist/wxå…¬ä¼—å·å·¥å…·/_internal/app/ai/

# åº”è¯¥çœ‹åˆ°:
# app/ai/
# â”œâ”€â”€ prompt/
# â”‚   â””â”€â”€ education_prompt.txt
# â””â”€â”€ ...
```

### 3. æ‰‹åŠ¨æµ‹è¯•è·¯å¾„å‡½æ•°

åœ¨æ‰“åŒ…åçš„åº”ç”¨ä¸­ï¼Œå¯ä»¥é€šè¿‡ FastAPI æ¥å£æµ‹è¯•ï¼š

```python
# æ·»åŠ æµ‹è¯•ç«¯ç‚¹åˆ° app/api/endpoints/test_api.py
@router.get("/test-resource-path")
async def test_resource_path():
    from app.utils.src_path import get_resource_path
    import os
    
    path = get_resource_path('app/ai/prompt')
    return {
        "path": path,
        "exists": os.path.exists(path),
        "contents": os.listdir(path) if os.path.exists(path) else []
    }
```

## ğŸ“ è¿˜æœ‰é—®é¢˜ï¼Ÿ

å¦‚æœä»¥ä¸Šæ–¹æ¡ˆéƒ½ä¸èƒ½è§£å†³é—®é¢˜ï¼š

1. è¿è¡Œå®Œæ•´è¯Šæ–­: `python app/ai/test/test_resource_path.py`
2. æ”¶é›†ä»¥ä¸‹ä¿¡æ¯:
   - æ“ä½œç³»ç»Ÿç‰ˆæœ¬
   - Python ç‰ˆæœ¬
   - PyInstaller ç‰ˆæœ¬
   - å®Œæ•´çš„é”™è¯¯æ—¥å¿—
   - è¯Šæ–­å·¥å…·è¾“å‡º
3. æ£€æŸ¥æ˜¯å¦æ˜¯æƒé™é—®é¢˜ï¼ˆç‰¹åˆ«æ˜¯ macOS Gatekeeperï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-12-29  
**çŠ¶æ€**: âœ… å·²ä¿®å¤ï¼Œå¾…é‡æ–°æ‰“åŒ…éªŒè¯

