# AIæ¨¡å—å¿«é€Ÿä½¿ç”¨æŒ‡å—

## ðŸŽ¯ é—®é¢˜è§£å†³

å¦‚æžœé‡åˆ° `ModuleNotFoundError: No module named 'app'` é”™è¯¯ï¼Œå·²ç»ä¿®å¤ï¼

## âœ… æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•

### 1ï¸âƒ£ é…ç½®çŽ¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.desktop` æ–‡ä»¶ï¼ˆå¦‚æžœè¿˜æ²¡æœ‰ï¼‰ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd /Users/yuye/YeahWork/Pythoné¡¹ç›®/wxPublicCrawl

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > .env.desktop << EOF
AI_API_KEY=your-openai-api-key
AI_BASE_URL=https://api.openai.com/v1
AI_MODEL=gpt-3.5-turbo
EOF
```

### 2ï¸âƒ£ è¿è¡Œå¿«é€Ÿæµ‹è¯•ï¼ˆæŽ¨èç¬¬ä¸€æ¬¡è¿è¡Œï¼‰

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /Users/yuye/YeahWork/Pythoné¡¹ç›®/wxPublicCrawl

# æ¿€æ´»è™šæ‹ŸçŽ¯å¢ƒï¼ˆå¦‚æžœè¿˜æ²¡æ¿€æ´»ï¼‰
source venv/bin/activate

# è¿è¡Œå¿«é€Ÿæµ‹è¯•
python app/ai/test/quick_test.py
```

è¿™ä¼šæµ‹è¯•ï¼š
- âœ“ AIé…ç½®æ˜¯å¦æ­£ç¡®
- âœ“ AIå®¢æˆ·ç«¯æ˜¯å¦å¯ç”¨
- âœ“ JSONå“åº”åŠŸèƒ½
- âœ“ æç¤ºè¯ç®¡ç†å™¨

### 3ï¸âƒ£ è¿è¡Œå®Œæ•´ç¤ºä¾‹

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python app/ai/test/usage_examples.py
```

è¿™ä¼šè¿è¡Œ8ä¸ªå®Œæ•´ç¤ºä¾‹ï¼š
1. åŸºç¡€AIå¯¹è¯
2. JSONæ ¼å¼å“åº”
3. æµå¼å“åº”
4. å¤šè½®å¯¹è¯ï¼ˆå¸¦åŽ†å²ï¼‰
5. æç¤ºè¯ç®¡ç†
6. PromptBuilderä½¿ç”¨
7. å†…å®¹åˆ†ç±»ï¼ˆå®žé™…ä¸šåŠ¡ï¼‰
8. é”™è¯¯å¤„ç†

## ðŸ“ åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨

### ç¤ºä¾‹1: ç®€å•å¯¹è¯

```python
from app.ai.code.ai_client import AIClient

async def my_function():
    client = AIClient()
    response = await client.chat(user_message="ä½ å¥½")
    print(response)
```

### ç¤ºä¾‹2: ä½¿ç”¨æ•™è‚²åˆ†æžåŠŸèƒ½

```python
from app.ai.code.education_analyze import analyze_education_articles
from app.schemas.wx_data import ArticleSimple

articles = [
    ArticleSimple(aid="1", title="å°å­¦æ•°å­¦æ•™å­¦"),
    ArticleSimple(aid="2", title="ä»Šæ—¥æ–°é—»")
]

education_ids = await analyze_education_articles(articles)
# è¿”å›ž: ["1"]
```

## ðŸ”§ å¸¸è§é—®é¢˜

### Q1: æç¤º API Key æœªé…ç½®

**è§£å†³æ–¹æ³•ï¼š**
1. æ£€æŸ¥ `.env.desktop` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®ä¿æ–‡ä»¶ä¸­æœ‰ `AI_API_KEY=xxx`
3. é‡æ–°è¿è¡Œç¨‹åº

### Q2: æç¤ºè¿žæŽ¥è¶…æ—¶

**å¯èƒ½åŽŸå› ï¼š**
1. ç½‘ç»œé—®é¢˜
2. API Base URL é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```bash
# å¦‚æžœä½¿ç”¨ä»£ç†ï¼Œé…ç½® AI_BASE_URL
# å¦‚æžœåœ¨å›½å†…ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å›½å†…çš„ OpenAI ä»£ç†æœåŠ¡
AI_BASE_URL=https://your-proxy-url/v1
```

### Q3: JSON è§£æžå¤±è´¥

**åŽŸå› ï¼š** AI è¿”å›žçš„å†…å®¹ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼

**è§£å†³æ–¹æ³•ï¼š**
1. é™ä½Ž temperatureï¼ˆå¦‚ 0.1ï¼‰æé«˜ç¨³å®šæ€§
2. åœ¨æç¤ºè¯ä¸­æ˜Žç¡®è¦æ±‚åªè¿”å›ž JSON
3. ä½¿ç”¨ `chat_with_json_response()` æ–¹æ³•ï¼Œå®ƒä¼šè‡ªåŠ¨æ¸…ç† Markdown ä»£ç å—

## ðŸ“š è¿›ä¸€æ­¥å­¦ä¹ 

- è¯¦ç»†æ–‡æ¡£: `app/ai/README.md`
- é‡æž„è¯´æ˜Ž: `app/ai/REFACTOR_SUMMARY.md`
- ä»£ç ç¤ºä¾‹: `app/ai/test/usage_examples.py`

## ðŸŽ“ æ·»åŠ è‡ªå·±çš„AIåŠŸèƒ½

### æ­¥éª¤1: åˆ›å»ºæç¤ºè¯æ–‡ä»¶

```bash
# åˆ›å»ºæç¤ºè¯
cat > app/ai/prompt/my_feature_prompt.txt << EOF
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åˆ†æžåŠ©æ‰‹ã€‚
è¯·åˆ†æžä»¥ä¸‹æ•°æ®ï¼š
{{ data }}

è¿”å›žJSONæ ¼å¼: {"result": "..."}
EOF
```

### æ­¥éª¤2: åˆ›å»ºåˆ†æžå‡½æ•°

```python
# app/ai/code/my_feature_analyze.py
from app.ai.code.ai_client import AIClient
from app.ai.code.prompt_manager import get_prompt_manager

async def analyze_my_feature(data: str):
    # åŠ è½½æç¤ºè¯
    manager = get_prompt_manager('app/ai/prompt')
    prompt = manager.render_prompt("my_feature_prompt", data=data)
    
    # è°ƒç”¨AI
    client = AIClient(temperature=0.3)
    result = await client.chat_with_json_response(
        user_message=prompt,
        system_message="ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åˆ†æžåŠ©æ‰‹"
    )
    
    return result
```

### æ­¥éª¤3: åœ¨APIä¸­ä½¿ç”¨

```python
from app.ai.code.my_feature_analyze import analyze_my_feature

@router.post("/my-feature-analyze")
async def api_analyze(data: str):
    result = await analyze_my_feature(data)
    return {"code": 0, "data": result}
```

## ðŸ’¡ æç¤º

1. **æµ‹è¯•å‰å…ˆè¿è¡Œå¿«é€Ÿæµ‹è¯•**ï¼š`python app/ai/test/quick_test.py`
2. **æŸ¥çœ‹æ—¥å¿—**ï¼šç¨‹åºä¼šè‡ªåŠ¨è®°å½•è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯
3. **è°ƒæ•´æ¸©åº¦å‚æ•°**ï¼š
   - åˆ†ç±»ä»»åŠ¡ç”¨ 0.1-0.3ï¼ˆæ›´ç¨³å®šï¼‰
   - å¯¹è¯ä»»åŠ¡ç”¨ 0.7-0.9ï¼ˆæ›´è‡ªç„¶ï¼‰
   - åˆ›ä½œä»»åŠ¡ç”¨ 0.9-1.2ï¼ˆæ›´æœ‰åˆ›æ„ï¼‰

---

**æ›´æ–°æ—¶é—´**: 2025-12-26  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¯¼å…¥é”™è¯¯

