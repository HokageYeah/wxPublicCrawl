2026-01-13 22:28:23 | INFO     | logging:callHandlers:1736 - 127.0.0.1:53819 - "GET /api/v1/wx/public/system/tags HTTP/1.1" 200
ResponseValidatorMiddleware
send_wrapper
2026-01-13 22:28:32 | INFO     | app.api.endpoints.ai_assistant:ai_query:105 - æ”¶åˆ°AIæŸ¥è¯¢: ç½—å±±çš„å¤©æ°”
2026-01-13 22:28:32 | INFO     | app.services.ai_assistant:query_ai_assistant:105 - æ”¶åˆ°AIæŸ¥è¯¢: ç½—å±±çš„å¤©æ°”
2026-01-13 22:28:32 | INFO     | app.ai.llm.mcp_llm_connect:query:185 - ğŸ“¨ æ”¶åˆ°ç”¨æˆ·æŸ¥è¯¢: ç½—å±±çš„å¤©æ°”
2026-01-13 22:28:32 | INFO     | app.ai.llm.mcp_llm_connect:query:197 - ğŸ”§ å¯ç”¨å·¥å…·æ•°é‡: 3
2026-01-13 22:28:32 | DEBUG    | app.ai.llm.mcp_llm_connect:query:200 - å·¥å…·åˆ—è¡¨: ['weather', 'calculator', 'get_wx_articles']2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-f3fe68a3-77d2-4ebb-8ee8-88d1c6016a6f', 'json_data': {'messages': [{'role': 'system', 'content': 'ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚å½“ç”¨æˆ·éœ€è¦æŸ¥è¯¢å¤©æ°”ã€è¿›è¡Œè®¡ç®—æˆ–æŸ¥æ‰¾çŸ¥è¯†æ—¶ï¼Œè¯·ä½¿ç”¨ç›¸åº”çš„å·¥å…·ã€‚'}, {'role': 'user', 'content': 'ç½—å±±çš„å¤©æ°”'}], 'model': 'deepseek-v3.2', 'max_tokens': 2000, 'temperature': 0.7, 'tool_choice': 'auto', 'tools': [{'type': 'function', 'function': {'name': 'weather', 'description': 'å…¨å›½å„åœ°å¤©æ°”æŸ¥è¯¢å·¥å…·ï¼Œè¾“å…¥åŸå¸‚åç§°ï¼Œè¿”å›è¯¥åŸå¸‚å¤©æ°”ä¿¡
æ¯ã€‚\n\nå¯ä»¥æŸ¥è¯¢çš„åŸå¸‚åŒ…æ‹¬ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³ç­‰ä¸»è¦åŸå¸‚ã€‚\næŸ¥è¯¢ç»“æœåŒ…å«å¤©æ°”çŠ¶å†µå’Œæ°”æ¸©ä¿¡æ¯ã€‚\n\nå‚æ•°:\n    location (str): éœ€è¦æŸ¥è¯¢å¤©æ°”çš„åŸå¸‚åç§°ï¼Œä¾‹å¦‚"åŒ—äº¬"ã€"ä¸Šæµ·"\n\nè¿”å›:\n    str: åŒ…å«åŸå¸‚åå’Œå¤©æ°”ä¿¡æ¯çš„å­—ç¬¦ä¸²\n', 'parameters': {'properties': {'location': {'title': 'Location', 'type': 'string'}}, 'required': ['location'], 'type': 'object'}}}, {'type': 'function', 'function': {'name': 'calculator', 'description': 'ç®€å•è®¡ç®—å™¨å·¥å…·ï¼Œå¯ä»¥æ‰§è¡ŒåŸºæœ¬çš„æ•°å­¦è¿ç®—ã€‚\n\næ”¯æŒåŠ æ³•(+)ã€å‡æ³•(-)ã€ä¹˜æ³•(*)ã€é™¤æ³•
(/)ç­‰åŸºæœ¬è¿ç®—ã€‚\nä¹Ÿæ”¯æŒå°æ•°ç‚¹å’Œæ‹¬å·è¿ç®—ã€‚\n\nå‚æ•°:\n    expression (str): æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚"1+2"ã€"3*4"ã€"10/2"\n    \nè¿”å›:\n 
   str: è®¡ç®—ç»“æœçš„å­—ç¬¦ä¸²è¡¨ç¤º\n    \nç¤ºä¾‹:\n    - "1+2" è¿”å› "è®¡ç®—ç»“æœ: 3"\n    - "10-5" è¿”å› "è®¡ç®—ç»“æœ: 5"\n    - "3*4" è¿”å› "è®¡ç®—ç»“æœ: 12"\n', 'parameters': {'properties': {'expression': {'title': 'Expression', 'type': 'string'}}, 'required': ['expression'], 'type': 'object'}}}, {'type': 'function', 'function': {'name': 'get_wx_articles', 'description': 'è·å–å¾®ä¿¡å…¬ä¼—å·æ‰€æœ‰æ–‡
ç« åˆ—è¡¨å·¥å…·ã€‚\n\næ ¹æ®å…¬ä¼—å·IDè‡ªåŠ¨ç¿»é¡µè·å–è¯¥å…¬ä¼—å·çš„æ‰€æœ‰æ–‡ç« ï¼Œå¹¶è¿”å›å®Œæ•´çš„æ–‡ç« åˆ—è¡¨ã€‚\næ­¤å·¥å…·ä¼šè‡ªåŠ¨ä»ç³»ç»ŸåŠ è½½ç”¨æˆ·è®¤è¯ä¿¡æ¯ï¼Œæ— éœ€æ‰‹
åŠ¨è®¾ç½®ã€‚\n\nå‚æ•°:\n    wx_public_id (str): å¾®ä¿¡å…¬ä¼—å·IDï¼ˆfakeidï¼‰\n\nè¿”å›:\n    str: JSONæ ¼å¼çš„æ–‡ç« åˆ—è¡¨å­—ç¬¦ä¸²ï¼ŒåŒ…å«æ‰€æœ‰æ–‡ç« ä¿¡ 
æ¯\n\nç¤ºä¾‹:\n    - è¾“å…¥å…¬ä¼—å·IDï¼Œè¿”å›è¯¥å…¬ä¼—å·æ‰€æœ‰å·²å‘å¸ƒçš„æ–‡ç« åˆ—è¡¨\n\næ³¨æ„:\n    - å·¥å…·ä¼šè‡ªåŠ¨åŠ è½½å·²ä¿å­˜çš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯\n    - è¿”
å›çš„æ•°æ®åŒ…å«æ–‡ç« æ ‡é¢˜ã€å‘å¸ƒæ—¶é—´ã€é“¾æ¥ç­‰è¯¦ç»†ä¿¡æ¯\n', 'parameters': {'properties': {'wx_public_id': {'title': 'Wx Public Id', 'type': 'string'}}, 'required': ['wx_public_id'], 'type': 'object'}}}]}}
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - Sending HTTP Request: POST https://apis.iflow.cn/v1/chat/completions
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - connect_tcp.started host='apis.iflow.cn' port=443 local_address=None timeout=5.0 socket_options=None
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x00000192308FA030>
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001923082AC30> server_hostname='apis.iflow.cn' timeout=5.0
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000019230990B90>
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - send_request_headers.started request=<Request [b'POST']>
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - send_request_headers.complete
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - send_request_body.started request=<Request [b'POST']>
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - send_request_body.complete
2026-01-13 22:28:32 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.started request=<Request [b'POST']>     
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'', [(b'Date', b'Tue, 13 Jan 2026 14:28:31 GMT'), (b'Content-Type', b'application/json;charset=UTF-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Server', b'Tengine'), (b'Vary', b'Accept-Encoding'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, PUT, PATCH, DELETE, OPTIONS'), (b'Access-Control-Allow-Headers', b'Authorization, Content-Type, x-biz-info, EagleEye-UserData, _csrf, priority'), (b'Vary', b'Origin'), (b'Vary', b'Access-Control-Request-Method'), (b'Vary', b'Access-Control-Request-Headers'), (b'Content-Encoding', b'gzip'), (b'Ups-Target-Key', b'apis.iflow.cn.vipserver'), (b'X-protocol', b'HTTP/1.1'), (b'EagleEye-TraceId', b'212c393517683145102706709e0e0e'), (b'Strict-Transport-Security', b'max-age=0'), (b's-brt', b'1070'), (b's-rt', b'1072')])
2026-01-13 22:28:33 | INFO     | logging:callHandlers:1736 - HTTP Request: POST https://apis.iflow.cn/v1/chat/completions "HTTP/1.1 200 "
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_body.started request=<Request [b'POST']>        
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_body.complete
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - response_closed.started
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - response_closed.complete
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - HTTP Response: POST https://apis.iflow.cn/v1/chat/completions "200 " Headers([('date', 'Tue, 13 Jan 2026 14:28:31 GMT'), ('content-type', 'application/json;charset=UTF-8'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('server', 'Tengine'), ('vary', 'Accept-Encoding'), ('access-control-allow-origin', '*'), ('access-control-allow-methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS'), ('access-control-allow-headers', 'Authorization, Content-Type, x-biz-info, EagleEye-UserData, _csrf, priority'), ('vary', 'Origin'), ('vary', 'Access-Control-Request-Method'), ('vary', 'Access-Control-Request-Headers'), ('content-encoding', 'gzip'), ('ups-target-key', 'apis.iflow.cn.vipserver'), ('x-protocol', 'HTTP/1.1'), ('eagleeye-traceid', '212c393517683145102706709e0e0e'), ('strict-transport-security', 'max-age=0'), ('s-brt', '1070'), ('s-rt', '1072')])
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - request_id: None
2026-01-13 22:28:33 | INFO     | app.ai.llm.mcp_llm_connect:_conversation_loop:267 - ğŸ”§ AIè¯·æ±‚è°ƒç”¨ 1 ä¸ªå·¥å…· (æ€»è®¡: 1/15)      
2026-01-13 22:28:33 | INFO     | app.ai.llm.mcp_llm_connect:_execute_tool_call:407 - ğŸ”§ æ‰§è¡Œå·¥å…·: weather
   å‚æ•°: {'location': 'ç½—å±±'}
2026-01-13 22:28:33 | INFO     | app.ai.mcp.mcp_client.client_manager:execute_tool:292 - ğŸ”§ æ‰§è¡ŒMCPå·¥å…·: weather
   å‚æ•°: {'location': 'ç½—å±±'}
2026-01-13 22:28:33 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:has_tool:264 - [fastmcp-demo-tools] æ£€æŸ¥å·¥å…· [weather]  
æ˜¯å¦å­˜åœ¨
2026-01-13 22:28:33 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:has_tool:274 - [fastmcp-demo-tools] âœ“ å·¥å…· [weather] å­˜ 
åœ¨
2026-01-13 22:28:33 | INFO     | app.ai.mcp.mcp_client.client_manager:execute_tool:301 -   âœ“ åœ¨å®¢æˆ·ç«¯ [fastmcp-demo-tools] ä¸­ 
æ‰¾åˆ°å·¥å…·
2026-01-13 22:28:33 | INFO     | app.ai.mcp.mcp_client.fastmcp_client:call_tool:391 - [fastmcp-demo-tools] ğŸ”§ è°ƒç”¨å·¥å…·: weather
   å‚æ•°: {'location': 'ç½—å±±'}
2026-01-13 22:28:33 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:has_tool:264 - [fastmcp-demo-tools] æ£€æŸ¥å·¥å…· [weather] 
æ˜¯å¦å­˜åœ¨
2026-01-13 22:28:33 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:has_tool:274 - [fastmcp-demo-tools] âœ“ å·¥å…· [weather] å­˜ 
åœ¨
2026-01-13 22:28:33 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:call_tool:411 - [fastmcp-demo-tools] æ­£åœ¨æ‰§è¡Œè¿œç¨‹è°ƒç”¨...2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - Sending client message: root=JSONRPCRequest(method='tools/call', 
params={'name': 'weather', 'arguments': {'location': 'ç½—å±±'}, '_meta': {'progressToken': 3}}, jsonrpc='2.0', id=3)
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - connect_tcp.started host='127.0.0.1' port=8008 local_address=None timeout=30 socket_options=None
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000019231E46F90>
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - send_request_headers.started request=<Request [b'POST']>
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - send_request_headers.complete
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - send_request_body.started request=<Request [b'POST']>
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - send_request_body.complete
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.started request=<Request [b'POST']>     
2026-01-13 22:28:33 | INFO     | app.ai.mcp.mcp_server.server_manager:_read_process_output:144 - [MCP-Server-stdout] INFO:    
 127.0.0.1:53833 - "POST /mcp/ HTTP/1.1" 200 OK
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Tue, 13 Jan 2026 14:28:33 GMT'), (b'server', b'uvicorn'), (b'cache-control', b'no-cache, no-transform'), 
(b'connection', b'keep-alive'), (b'content-type', b'text/event-stream'), (b'mcp-session-id', b'7a818fc8e65d4d1a9e20825b875107b5'), (b'x-accel-buffering', b'no'), (b'Transfer-Encoding', b'chunked')])
2026-01-13 22:28:33 | INFO     | logging:callHandlers:1736 - HTTP Request: POST http://127.0.0.1:8008/mcp/ "HTTP/1.1 200 OK"  
2026-01-13 22:28:33 | WARNING  | app.ai.mcp.mcp_server.server_manager:_read_process_output:142 - [MCP-Server-stderr] 2026-01-13 22:28:33.988 | INFO     | app.ai.mcp.mcp_server.fastmcp_server:weather:69 - [MCP] Ñ¯: É½
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - receive_response_body.started request=<Request [b'POST']>        
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - SSE message: root=JSONRPCResponse(jsonrpc='2.0', id=3, result={'content': [{'type': 'text', 'text': 'ç½—å±±å¤©æ°”: å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜'}], 'isError': False})
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - response_closed.started
2026-01-13 22:28:33 | DEBUG    | logging:callHandlers:1736 - response_closed.complete
2026-01-13 22:28:33 | INFO     | app.ai.mcp.mcp_client.fastmcp_client:call_tool:425 - [fastmcp-demo-tools] âœ… å·¥å…·è°ƒç”¨æˆåŠŸ: wea
ther
2026-01-13 22:28:34 | DEBUG    | app.ai.mcp.mcp_client.fastmcp_client:call_tool:428 - [fastmcp-demo-tools] å“åº”: [TextContent(type='text', text='ç½—å±±å¤©æ°”: å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜', annotations=None, meta=None)]
2026-01-13 22:28:34 | INFO     | app.ai.mcp.mcp_client.client_manager:execute_tool:308 -   âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ: weather
2026-01-13 22:28:34 | DEBUG    | app.ai.mcp.mcp_client.client_manager:execute_tool:311 -   ç»“æœ: [TextContent(type='text', text='ç½—å±±å¤©æ°”: å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜', annotations=None, meta=None)]
2026-01-13 22:28:34 | INFO     | app.ai.llm.mcp_llm_connect:_execute_tool_call:421 - âœ… å·¥å…·æ‰§è¡ŒæˆåŠŸ: weather
2026-01-13 22:28:34 | DEBUG    | app.ai.llm.mcp_llm_connect:_format_tool_result:472 - æ ¼å¼åŒ–å·¥å…·ç»“æœç±»å‹: <class 'list'>, å€¼: 
[TextContent(type='text', text='ç½—å±±å¤©æ°”: å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜', annotations=None, meta=None)]
2026-01-13 22:28:34 | DEBUG    | app.ai.llm.mcp_llm_connect:_format_tool_result:494 - æ£€æµ‹åˆ°TextContentå¯¹è±¡åˆ—è¡¨
2026-01-13 22:28:34 | DEBUG    | app.ai.llm.mcp_llm_connect:_format_tool_result:500 - âœ… ä»TextContentåˆ—è¡¨æå–æ–‡æœ¬: ç½—å±±å¤©æ°”:  
å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜
2026-01-13 22:28:34 | DEBUG    | app.ai.llm.mcp_llm_connect:_conversation_loop:294 - ç»§ç»­å¯¹è¯å¾ªç¯ï¼Œè®©AIå¤„ç†å·¥å…·ç»“æœ...        
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-e93cf22b-7fdc-43cd-b201-10f9d64235e1', 'json_data': {'messages': [{'role': 'system', 'content': 'ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„AIåŠ©æ‰‹ã€‚å½“ç”¨æˆ·éœ€è¦æŸ¥è¯¢å¤©æ°”ã€è¿›è¡Œè®¡ç®—æˆ–æŸ¥æ‰¾çŸ¥è¯†æ—¶ï¼Œè¯·ä½¿ç”¨ç›¸åº”çš„å·¥å…·ã€‚'}, {'role': 'user', 'content': 'ç½—å±±çš„å¤©æ°”'}, {'role': 'tool', 'tool_call_id': 'chatcmpl-tool-bb12ceb009ea4eee96ac0707648e9b38', 'name': 'weather', 'content': '{"success": true, "result": "ç½—å±±å¤©æ°”: å¤šäº‘ï¼Œæ°”æ¸©-20Â°Cï¼Œç©ºæ°”è´¨é‡ä¼˜", "tool_name": "weather"}'}], 'model': 'deepseek-v3.2', 'max_tokens': 2000, 'temperature': 0.7, 'tool_choice': 'auto', 'tools': [{'type': 'function', 'function': {'name': 'weather', 'description': 'å…¨å›½å„åœ°å¤©æ°”æŸ¥è¯¢å·¥å…·ï¼Œè¾“å…¥åŸå¸‚åç§°ï¼Œè¿”å›è¯¥åŸå¸‚å¤©æ°”ä¿¡æ¯ã€‚\n\nå¯ä»¥æŸ¥è¯¢çš„åŸå¸‚åŒ…æ‹¬ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿
å·ã€æ·±åœ³ç­‰ä¸»è¦åŸå¸‚ã€‚\næŸ¥è¯¢ç»“æœåŒ…å«å¤©æ°”çŠ¶å†µå’Œæ°”æ¸©ä¿¡æ¯ã€‚\n\nå‚æ•°:\n    location (str): éœ€è¦æŸ¥è¯¢å¤©æ°”çš„åŸå¸‚åç§°ï¼Œä¾‹å¦‚"åŒ—äº¬"ã€"ä¸Šæµ·
"\n\nè¿”å›:\n    str: åŒ…å«åŸå¸‚åå’Œå¤©æ°”ä¿¡æ¯çš„å­—ç¬¦ä¸²\n', 'parameters': {'properties': {'location': {'title': 'Location', 'type': 
'string'}}, 'required': ['location'], 'type': 'object'}}}, {'type': 'function', 'function': {'name': 'calculator', 'description': 'ç®€å•è®¡ç®—å™¨å·¥å…·ï¼Œå¯ä»¥æ‰§è¡ŒåŸºæœ¬çš„æ•°å­¦è¿ç®—ã€‚\n\næ”¯æŒåŠ æ³•(+)ã€å‡æ³•(-)ã€ä¹˜æ³•(*)ã€é™¤æ³•(/)ç­‰åŸºæœ¬è¿ç®—ã€‚\nä¹Ÿæ”¯æŒå°æ•°ç‚¹å’Œæ‹¬å·è¿ç®—ã€‚\n\nå‚æ•°:\n    expression (str): æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚"1+2"ã€"3*4"ã€"10/2"\n    \nè¿”å›:\n    str: è®¡ç®—ç»“æœçš„å­—ç¬¦ä¸²è¡¨ç¤º\n    \nç¤ºä¾‹:\n    - "1+2" è¿”å› "è®¡ç®—ç»“æœ: 3"\n    - "10-5" è¿”å› "è®¡ç®—ç»“æœ: 5"\n    - "3*4" è¿”å› "è®¡ç®—ç»“æœ: 12"\n', 'parameters': {'properties': {'expression': {'title': 'Expression', 'type': 'string'}}, 'required': ['expression'], 'type': 'object'}}}, {'type': 'function', 'function': {'name': 'get_wx_articles', 'description': 'è·å–å¾®ä¿¡å…¬ä¼—å·æ‰€æœ‰æ–‡ç« åˆ—è¡¨å·¥å…·ã€‚\n\næ ¹æ®å…¬ä¼—å·IDè‡ªåŠ¨ç¿»é¡µè·å–è¯¥
å…¬ä¼—å·çš„æ‰€æœ‰æ–‡ç« ï¼Œå¹¶è¿”å›å®Œæ•´çš„æ–‡ç« åˆ—è¡¨ã€‚\næ­¤å·¥å…·ä¼šè‡ªåŠ¨ä»ç³»ç»ŸåŠ è½½ç”¨æˆ·è®¤è¯ä¿¡æ¯ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®ã€‚\n\nå‚æ•°:\n    wx_public_id (str): å¾®ä¿¡å…¬ä¼—å·IDï¼ˆfakeidï¼‰\n\nè¿”å›:\n    str: JSONæ ¼å¼çš„æ–‡ç« åˆ—è¡¨å­—ç¬¦ä¸²ï¼ŒåŒ…å«æ‰€æœ‰æ–‡ç« ä¿¡æ¯\n\nç¤ºä¾‹:\n    - è¾“å…¥å…¬ä¼—å·IDï¼Œè¿”å›è¯¥å…¬ä¼—
å·æ‰€æœ‰å·²å‘å¸ƒçš„æ–‡ç« åˆ—è¡¨\n\næ³¨æ„:\n    - å·¥å…·ä¼šè‡ªåŠ¨åŠ è½½å·²ä¿å­˜çš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯\n    - è¿”å›çš„æ•°æ®åŒ…å«æ–‡ç« æ ‡é¢˜ã€å‘å¸ƒæ—¶é—´ã€é“¾æ¥ç­‰è¯¦ç»† 
ä¿¡æ¯\n', 'parameters': {'properties': {'wx_public_id': {'title': 'Wx Public Id', 'type': 'string'}}, 'required': ['wx_public_id'], 'type': 'object'}}}]}}
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - Sending HTTP Request: POST https://apis.iflow.cn/v1/chat/completions
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - send_request_headers.started request=<Request [b'POST']>
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - send_request_headers.complete
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - send_request_body.started request=<Request [b'POST']>
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - send_request_body.complete
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.started request=<Request [b'POST']>     
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - receive_response_body.failed exception=GeneratorExit()
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - receive_response_headers.complete return_value=(b'HTTP/1.1', 400, b'', [(b'Date', b'Tue, 13 Jan 2026 14:28:31 GMT'), (b'Content-Type', b'application/json;charset=UTF-8'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'Server', b'Tengine'), (b'Access-Control-Allow-Origin', b'*'), (b'Access-Control-Allow-Methods', b'GET, POST, PUT, PATCH, DELETE, OPTIONS'), (b'Access-Control-Allow-Headers', b'Authorization, Content-Type, x-biz-info, EagleEye-UserData, _csrf, priority'), (b'Vary', b'Origin'), (b'Vary', b'Access-Control-Request-Method'), (b'Vary', b'Access-Control-Request-Headers'), (b'Ups-Target-Key', b'apis.iflow.cn.vipserver'), (b'X-protocol', b'HTTP/1.1'), (b'EagleEye-TraceId', b'212c393517683145114366738e0e0e'), (b's-brt', b'222'), (b's-rt', b'224')])
2026-01-13 22:28:34 | INFO     | logging:callHandlers:1736 - HTTP Request: POST https://apis.iflow.cn/v1/chat/completions "HTTP/1.1 400 "
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - receive_response_body.started request=<Request [b'POST']>        
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - receive_response_body.complete
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - response_closed.started
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - response_closed.complete
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - HTTP Response: POST https://apis.iflow.cn/v1/chat/completions "400 " Headers([('date', 'Tue, 13 Jan 2026 14:28:31 GMT'), ('content-type', 'application/json;charset=UTF-8'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('server', 'Tengine'), ('access-control-allow-origin', '*'), ('access-control-allow-methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS'), ('access-control-allow-headers', 'Authorization, Content-Type, x-biz-info, EagleEye-UserData, _csrf, priority'), ('vary', 'Origin'), ('vary', 'Access-Control-Request-Method'), ('vary', 'Access-Control-Request-Headers'), ('ups-target-key', 'apis.iflow.cn.vipserver'), ('x-protocol', 'HTTP/1.1'), ('eagleeye-traceid', '212c393517683145114366738e0e0e'), ('s-brt', '222'), ('s-rt', '224')])
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - request_id: None
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - Encountered httpx.HTTPStatusError
Traceback (most recent call last):

  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(parent_pid=12200, pipe_handle=768)
                                      â”‚           â”” <function spawn_main at 0x00000192286B96C0>
                                      â”” <function spawn_main at 0x00000192286B96C0>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 122, in spawn_main    
    exitcode = _main(fd, parent_sentinel)
               â”‚     â”‚   â”” 296
               â”‚     â”” 3
               â”” <function _main at 0x00000192286B9760>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           â”‚    â”‚          â”” 296
           â”‚    â”” <function BaseProcess._bootstrap at 0x00000192283BB1A0>
           â”” <SpawnProcess name='SpawnProcess-1' parent=12200 started>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 313, in _bootstrap  
    self.run()
    â”‚    â”” <function BaseProcess.run at 0x0000019228362CA0>
    â”” <SpawnProcess name='SpawnProcess-1' parent=12200 started>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    â”‚    â”‚        â”‚    â”‚        â”‚    â”” {'config': <uvicorn.config.Config object at 0x000001922A7AF620>, 'target': <bound method Server.run of <uvicorn.server.Server...
    â”‚    â”‚        â”‚    â”‚        â”” <SpawnProcess name='SpawnProcess-1' parent=12200 started>
    â”‚    â”‚        â”‚    â”” ()
    â”‚    â”‚        â”” <SpawnProcess name='SpawnProcess-1' parent=12200 started>
    â”‚    â”” <function subprocess_started at 0x000001922A8A84A0>
    â”” <SpawnProcess name='SpawnProcess-1' parent=12200 started>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    â”‚              â”” [<socket.socket fd=516, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]
    â”” <bound method Server.run of <uvicorn.server.Server object at 0x000001922A7AF770>>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\uvicorn\server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           â”‚       â”‚   â”‚    â”‚             â”” [<socket.socket fd=516, family=2, type=1, proto=6, laddr=('127.0.0.1', 8002)>]    
           â”‚       â”‚   â”‚    â”” <function Server.serve at 0x000001922A8A3740>
           â”‚       â”‚   â”” <uvicorn.server.Server object at 0x000001922A7AF770>
           â”‚       â”” <function run at 0x000001922A10CE00>
           â”” <module 'asyncio' from 'C:\\Users\\HokageYeah\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\asyncio\\__init__.py'>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           â”‚      â”‚   â”” <coroutine object Server.serve at 0x000001922A817E60>
           â”‚      â”” <function Runner.run at 0x000001922A560720>
           â”” <asyncio.runners.Runner object at 0x000001922A8E0590>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           â”‚    â”‚     â”‚                  â”” <Task pending name='Task-1' coro=<Server.serve() running at D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆ 
é›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\uvic...
           â”‚    â”‚     â”” <function BaseEventLoop.run_until_complete at 0x000001922A55E0C0>
           â”‚    â”” <_WindowsSelectorEventLoop running=True closed=False debug=False>
           â”” <asyncio.runners.Runner object at 0x000001922A8E0590>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 707, in run_until_complete
    self.run_forever()
    â”‚    â”” <function BaseEventLoop.run_forever at 0x000001922A55E020>
    â”” <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 678, in run_forever     
    self._run_once()
    â”‚    â”” <function BaseEventLoop._run_once at 0x000001922A55FE20>
    â”” <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 2033, in _run_once      
    handle._run()
    â”‚      â”” <function Handle._run at 0x000001922A0CD3A0>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x0000019230DC9C90>()>
  File "C:\Users\HokageYeah\AppData\Local\Programs\Python\Python313\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    â”‚    â”‚            â”‚    â”‚           â”‚    â”” <member '_args' of 'Handle' objects>
    â”‚    â”‚            â”‚    â”‚           â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x0000019230DC9C90>()>
    â”‚    â”‚            â”‚    â”” <member '_callback' of 'Handle' objects>
    â”‚    â”‚            â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x0000019230DC9C90>()>
    â”‚    â”” <member '_context' of 'Handle' objects>
    â”” <Handle <_asyncio.TaskStepMethWrapper object at 0x0000019230DC9C90>()>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\middleware\base.py", line 141, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          â”‚    â”‚   â”‚      â”‚                      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000192308BD260>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚    â”‚   â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”‚    â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019230678590>
          â”” <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000192306786E0>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          â”‚                            â”‚    â”‚    â”‚     â”‚      â”‚        â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000192308BD260>
          â”‚                            â”‚    â”‚    â”‚     â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚                            â”‚    â”‚    â”‚     â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”‚                            â”‚    â”‚    â”” <starlette.requests.Request object at 0x000001923072BF50>
          â”‚                            â”‚    â”” <fastapi.routing.APIRouter object at 0x00000192305E0450>
          â”‚                            â”” <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000019230678590>   
          â”” <function wrap_app_handling_exceptions at 0x000001922B99E980>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          â”‚   â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000192308BD580>
          â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚   â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”” <fastapi.routing.APIRouter object at 0x00000192305E0450>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__ 
    await self.middleware_stack(scope, receive, send)
          â”‚    â”‚                â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender 
at 0x00000192308BD580>
          â”‚    â”‚                â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚    â”‚                â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”‚    â”” <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000192305E0450>>
          â”” <fastapi.routing.APIRouter object at 0x00000192305E0450>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\routing.py", line 734, in app      
    await route.handle(scope, receive, send)
          â”‚     â”‚      â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000192308BD580>
          â”‚     â”‚      â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚     â”‚      â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': 
('127.0.0.1', 8002), 'cl...
          â”‚     â”” <function Route.handle at 0x000001922B9C8040>
          â”” APIRoute(path='/api/v1/wx/public/ai/query', name='ai_query', methods=['POST'])
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\routing.py", line 288, in handle   
    await self.app(scope, receive, send)
          â”‚    â”‚   â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000192308BD580>
          â”‚    â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚    â”‚   â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”‚    â”” <function request_response.<locals>.app at 0x0000019230639300>
          â”” APIRoute(path='/api/v1/wx/public/ai/query', name='ai_query', methods=['POST'])
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\routing.py", line 76, in app       
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          â”‚                            â”‚    â”‚        â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000192308BD580>
          â”‚                            â”‚    â”‚        â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚                            â”‚    â”‚        â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”‚                            â”‚    â”” <starlette.requests.Request object at 0x000001923088A6D0>
          â”‚                            â”” <function request_response.<locals>.app.<locals>.app at 0x00000192308BE980>
          â”” <function wrap_app_handling_exceptions at 0x000001922B99E980>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          â”‚   â”‚      â”‚        â”” <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000192308BD120>
          â”‚   â”‚      â”” <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000192308A7CE0>
          â”‚   â”” {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8002), 'cl...
          â”” <function request_response.<locals>.app.<locals>.app at 0x00000192308BE980>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\starlette\routing.py", line 73, in app       
    response = await f(request)
                     â”‚ â”” <starlette.requests.Request object at 0x000001923088A6D0>
                     â”” <function get_request_handler.<locals>.app at 0x00000192306391C0>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\fastapi\routing.py", line 301, in app        
    raw_response = await run_endpoint_function(
                         â”” <function run_endpoint_function at 0x000001922B99E160>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
                 â”‚         â”‚      â”” {'request': AIQueryRequest(query='ç½—å±±çš„å¤©æ°”', enable_tools=True, temperature=None)}      
                 â”‚         â”” <function ai_query at 0x000001923051DB20>
                 â”” Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\app\api\endpoints\ai_assistant.py", line 108, in ai_query
    result = await query_ai_assistant(
                   â”” <function query_ai_assistant at 0x000001923051D760>

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\app\services\ai_assistant.py", line 125, in query_ai_assistant      
    response_text = await connector.query(
                          â”‚         â”” <function MCPLLMConnect.query at 0x000001923051CF40>
                          â”” <app.ai.llm.mcp_llm_connect.MCPLLMConnect object at 0x00000192308B96D0>

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\app\ai\llm\mcp_llm_connect.py", line 205, in query
    final_response = await self._conversation_loop(
                           â”‚    â”” <function MCPLLMConnect._conversation_loop at 0x000001923051CFE0>
                           â”” <app.ai.llm.mcp_llm_connect.MCPLLMConnect object at 0x00000192308B96D0>

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\app\ai\llm\mcp_llm_connect.py", line 240, in _conversation_loop     
    response = await self._call_ai_with_tools(
                     â”‚    â”” <function MCPLLMConnect._call_ai_with_tools at 0x000001923051D080>
                     â”” <app.ai.llm.mcp_llm_connect.MCPLLMConnect object at 0x00000192308B96D0>

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\app\ai\llm\mcp_llm_connect.py", line 321, in _call_ai_with_tools    
    response = await self.ai_client.client.chat.completions.create(
                     â”‚    â”‚         â”‚      â”‚    â”‚           â”” <function AsyncCompletions.create at 0x0000019230AB49A0>        
                     â”‚    â”‚         â”‚      â”‚    â”” <openai.resources.chat.completions.completions.AsyncCompletions object at 0x0000019230DC2BA0>
                     â”‚    â”‚         â”‚      â”” <openai.resources.chat.chat.AsyncChat object at 0x0000019230DC2900>
                     â”‚    â”‚         â”” <openai.AsyncOpenAI object at 0x0000019230642210>
                     â”‚    â”” <app.ai.llm.ai_client.AIClient object at 0x00000192308B9310>
                     â”” <app.ai.llm.mcp_llm_connect.MCPLLMConnect object at 0x00000192308B96D0>

  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\openai\resources\chat\completions\completions.py", line 2603, in create
    return await self._post(
                 â”‚    â”” <bound method AsyncAPIClient.post of <openai.AsyncOpenAI object at 0x0000019230642210>>
                 â”” <openai.resources.chat.completions.completions.AsyncCompletions object at 0x0000019230DC2BA0>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\openai\_base_client.py", line 1794, in post  
    return await self.request(cast_to, opts, stream=stream, stream_cls=stream_cls)
                 â”‚    â”‚       â”‚        â”‚            â”‚                  â”” openai.AsyncStream[openai.types.chat.chat_completion_chunk.ChatCompletionChunk]
                 â”‚    â”‚       â”‚        â”‚            â”” False
                 â”‚    â”‚       â”‚        â”” FinalRequestOptions(method='post', url='/chat/completions', params={}, headers=NOT_GIVEN, max_retries=NOT_GIVEN, timeout=NOT_...
                 â”‚    â”‚       â”” <class 'openai.types.chat.chat_completion.ChatCompletion'>
                 â”‚    â”” <function AsyncAPIClient.request at 0x000001922E97E7A0>
                 â”” <openai.AsyncOpenAI object at 0x0000019230642210>
> File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\openai\_base_client.py", line 1574, in request
    response.raise_for_status()
    â”‚        â”” <function Response.raise_for_status at 0x000001922D9E51C0>
    â”” <Response [400 ]>
  File "D:\æ•²æ•²ä»£ç \é¡¹ç›®ä»£ç åˆé›†\Pythoné¡¹ç›®\wxPublicCrawl\venv\Lib\site-packages\httpx\_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
          â”‚               â”‚                â”‚                 â”” <Response [400 ]>
          â”‚               â”‚                â”” <Request('POST', 'https://apis.iflow.cn/v1/chat/completions')>
          â”‚               â”” "Client error '400 ' for url 'https://apis.iflow.cn/v1/chat/completions'\nFor more information check: https://developer.mozil...
          â”” <class 'httpx.HTTPStatusError'>

httpx.HTTPStatusError: Client error '400 ' for url 'https://apis.iflow.cn/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/400
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - Not retrying
2026-01-13 22:28:34 | DEBUG    | logging:callHandlers:1736 - Re-raising status error
2026-01-13 22:28:34 | ERROR    | app.ai.llm.mcp_llm_connect:query:216 - æŸ¥è¯¢å¤±è´¥: "'extend_fields'"
2026-01-13 22:28:34 | DEBUG    | app.services.ai_assistant:_extract_tool_calls_from_history:182 - å·¥å…·è°ƒç”¨ä¿¡æ¯- tool_call: {  
  "id": "chatcmpl-tool-bb12ceb009ea4eee96ac0707648e9b38",
  "type": "function",
  "function": {
    "name": "weather",
    "arguments": "{\"location\": \"\\u7f57\\u5c71\"}"
  }
}
2026-01-13 22:28:34 | DEBUG    | app.services.ai_assistant:_extract_tool_calls_from_history:190 - å·¥å…·è°ƒç”¨ä¿¡æ¯- tool_info: {  
  "tool_name": "weather",
  "arguments": "{\"location\": \"\\u7f57\\u5c71\"}",
  "result": "",
  "success": true,
  "execution_time": null
}
2026-01-13 22:28:34 | INFO     | app.services.ai_assistant:query_ai_assistant:139 - AIæŸ¥è¯¢å®Œæˆ - å·¥å…·è°ƒç”¨: 1æ¬¡
2026-01-13 22:28:34 | DEBUG    | app.api.endpoints.ai_assistant:ai_query:128 - AIQueryResponseå¯¹è±¡: {
  "response": "æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºç°é”™è¯¯: \"'extend_fields'\"",
  "tool_calls_count": 1,
  "tool_calls": [
    {
      "tool_name": "weather",
      "arguments": {
        "location": "ç½—å±±"
      },
      "result": "",
      "success": true,
      "execution_time": null
    }
  ],
  "success": true,
  "error": null
}