# 🎉 双服务集成完成

已成功配置前端同时调用两个后端服务的功能。

---

## ✅ 完成的工作

### 1. 环境配置
- ✅ 更新 `.env.development` - 添加卡密服务开发环境配置
- ✅ 更新 `.env.production` - 添加卡密服务生产环境配置
- ✅ 创建 `.env.example` - 提供环境变量配置示例
- ✅ 更新 `vite.config.ts` - 添加卡密服务代理配置

### 2. Request 工具
- ✅ 修改 `utils/request.ts` - 将 Request 类改为可导出和继承
- ✅ 创建 `utils/licenseRequest.ts` - 卡密服务专用请求实例

### 3. Service 层
- ✅ 创建 `services/licenseService.ts` - 卡密服务 API 封装
  - 用户注册/登录/登出
  - 获取用户信息
  - 卡密绑定/验证/查询
  - Token 刷新

### 4. 状态管理
- ✅ 创建 `stores/licenseStore.ts` - 卡密服务状态管理
  - 用户信息管理
  - Token 管理（支持 localStorage 持久化）
  - 登录状态管理
  - 卡密状态管理

### 5. 文档
- ✅ 更新 `docs/API接口速查表.md` - 添加前端调用配置说明
- ✅ 创建 `docs/卡密服务集成指南.md` - 详细的使用文档
- ✅ 创建 `docs/双服务配置说明.md` - 配置总结文档

---

## 📁 文件清单

### 修改的文件（4个）
1. `web/.env.development`
2. `web/.env.production`
3. `web/vite.config.ts`
4. `web/src/utils/request.ts`

### 新增的文件（6个）
1. `web/.env.example`
2. `web/src/utils/licenseRequest.ts`
3. `web/src/services/licenseService.ts`
4. `web/src/stores/licenseStore.ts`
5. `web/docs/卡密服务集成指南.md`
6. `web/docs/双服务配置说明.md`

---

## 🚀 快速开始

### 1. 查看配置文档
```bash
# 查看详细集成指南
cat web/docs/卡密服务集成指南.md

# 查看配置说明
cat web/docs/双服务配置说明.md
```

### 2. 启动服务
```bash
# 启动主应用服务（端口 8002）
python run_app.py

# 启动卡密服务（端口 8003）
# 请根据实际情况启动你的卡密服务

# 启动前端开发服务器
cd web
npm run dev
```

### 3. 在代码中使用
```typescript
// 调用卡密服务
import { login, bindLicense } from '@/services/licenseService';
import { useLicenseStore } from '@/stores/licenseStore';

// 登录
const result = await login({
  username: 'testuser',
  password: 'password123'
});

// 保存状态
const licenseStore = useLicenseStore();
licenseStore.setToken(result.token);
licenseStore.setUserInfo(result.userInfo);

// 绑定卡密
await bindLicense({ licenseKey: 'XXXX-XXXX-XXXX-XXXX' });
```

---

## 📖 关键概念

### 两个服务的区别

| 特性 | 主应用服务（8002） | 卡密服务（8003） |
|------|-------------------|-----------------|
| **用途** | 微信公众号爬虫、喜马拉雅等 | 用户认证、卡密管理 |
| **代理前缀** | `/web-api` | `/license-api` |
| **Request 实例** | `request` (默认) | `licenseRequest` |
| **Service 示例** | `wechatService`, `xmlyService` | `licenseService` |
| **Store 示例** | `wechatLoginStore`, `xmlyLoginStore` | `licenseStore` |

### 请求流程

**开发环境**：
```
前端调用 → Vite 代理 → 后端服务
```

**生产环境**：
```
前端调用 → 直接访问后端
```

---

## 🎯 下一步

根据你的实际需求，可以：

1. **创建登录页面**
   - 参考 `docs/卡密服务集成指南.md` 中的组件示例
   - 使用 `licenseService` 和 `licenseStore`

2. **添加路由守卫**
   - 检查用户登录状态
   - 验证卡密有效性

3. **集成到现有页面**
   - 在需要权限控制的页面添加卡密验证
   - 使用 `licenseStore.isLoggedIn` 判断登录状态

4. **优化用户体验**
   - 添加 Token 自动刷新
   - 处理 Token 过期自动跳转登录

---

## 💡 提示

- 所有涉及卡密服务的调用都应使用 `licenseRequest` 或 `licenseService`
- 主应用服务继续使用原来的 `request` 和相应的 service
- Token 会自动保存到 `localStorage`，刷新页面不会丢失
- 详细使用方法请查看 `docs/卡密服务集成指南.md`

---

## 📞 支持

如有问题，请查看：
- [卡密服务集成指南](./docs/卡密服务集成指南.md)
- [双服务配置说明](./docs/双服务配置说明.md)
- [API 接口速查表](./docs/API接口速查表.md)

---

**配置完成时间**: 2026-02-02  
**状态**: ✅ 可以使用
